'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _rapidMixAdapters=require('rapid-mix-adapters');var _rapidMixAdapters2=_interopRequireDefault(_rapidMixAdapters);var _Example=require('./Example');var _Example2=_interopRequireDefault(_Example);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}// source : https://stackoverflow.com/questions/15251879/how-to-check-if-a-variable-is-a-typed-array-in-javascript
var isArray=function isArray(v){return v.constructor===Float32Array||v.constructor===Float64Array||Array.isArray(v);};/**
 * Manage and format a set of recorded examples, maintain a RapidMix compliant
 * training set.
 *
 * @param {Number} [inputDimension=null] - Input dimension
 *  (if `null`, is guessed from the first recorded element)
 * @param {Number} [outputDimension=null] - Output dimension.
 *  (if `null`, is guessed from the first recorded element).
 *
 * @example
 * import * as mano from 'mano-js/client';
 *
 * const example = new mano.Example();
 * const trainingSet = new mano.TrainingSet();
 * const xmmProcessor = new mano.XmmProcesssor();
 *
 * example.setLabel('test');
 * example.addElement([0, 1, 2, 3]);
 * const rapidMixJsonExample = example.toJSON();
 *
 * trainingSet.addExample(rapidMixJsonExample);
 * const rapidMixJsonTrainingSet = trainingSet.toJSON();
 *
 * xmmProcessor
 *   .train(rapidMixJsonTrainingSet)
 *   .then(() => { ... });
 */var TrainingSet=function(){function TrainingSet(){var inputDimension=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var outputDimension=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var columnNames=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];(0,_classCallCheck3.default)(this,TrainingSet);if(inputDimension!==null){this.fixedDimensions=true;this.inputDimension=inputDimension;this.outputDimension=outputDimension!==null?outputDimension:0;}else{this.fixedDimensions=false;}this.columnNames=columnNames;this.clear();}/**
   * Get the number of examples.
   */(0,_createClass3.default)(TrainingSet,[{key:'clear',/**
   * Clear the training set.
   */value:function clear(){if(!this.fixedDimensions){this.inputDimension=null;this.outputDimension=null;}this.data=[];}/**
   * Add an example to the training set.
   *
   * @param {JSON} example - A RapidMix formatted example.
   */},{key:'addExample',value:function addExample(example){var e=example.payload;this._checkDimensions(e.input[0],e.output[0]);if(e.input.length===0){throw new Error('examples must contain at least one input vector');}this.data.push({label:e.label,input:e.input,output:e.output});}/**
   * Add all examples from another RapidMix JSON training set.
   *
   * @param {JSON} trainingSet - A RapidMix compliant training set.
   */},{key:'addTrainingSet',value:function addTrainingSet(trainingSet){var examples=trainingSet.payload.data;var e=examples[0];this._checkDimensions(e.input[0],e.output[0]);for(var i=0;i<examples.length;i++){e=examples[i];this.data.push({label:e.label,input:e.input,output:e.output});}}/**
   * Initialize from another RapidMix JSON training set. If `null`, clear the
   * trainingSet.
   *
   * @param {JSON} trainingSet - A RapidMix compliant training set.
   */},{key:'setTrainingSet',value:function setTrainingSet(){var trainingSet=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(trainingSet===null)return this.clear();var set=trainingSet.payload;this.inputDimension=set.inputDimension;this.outputDimension=set.outputDimension;this.data=set.data;this.columnNames=set.columnNames;}/**
   * Return the RapidMix compliant training set in JSON format.
   *
   * @return {JSON} - Training set.
   */},{key:'toJSON',value:function toJSON(){return{docType:'rapid-mix:training-set',docVersion:_rapidMixAdapters2.default.RAPID_MIX_DOC_VERSION,payload:{inputDimension:this.inputDimension,outputDimension:this.outputDimension,data:this.data}};}/**
   * Return an array of the current training set labels.
   *
   * @return {Array.String} - Training set sorted labels.
   */},{key:'getLabels',value:function getLabels(){var labels=[];for(var i=0;i<this.data.length;i++){var label=this.data[i].label;if(labels.indexOf(label)===-1)labels.push(label);}return labels.sort();}/**
   * Remove all examples of a certain label.
   *
   * @param {String} label - The label of the recordings to be removed.
   */},{key:'removeExamplesByLabel',value:function removeExamplesByLabel(label){this.data=this.data.filter(function(datum){return datum.label!==label;});}/**
   * Remove example at index.
   *
   * @param {Number} index - The index of the example to remove.
   */},{key:'removeExampleAtIndex',value:function removeExampleAtIndex(index){this.data.splice(index,1);}/** @private */},{key:'_checkDimensions',value:function _checkDimensions(inputVector,outputVector){if(!isArray(inputVector)||outputVector&&!isArray(outputVector)){throw new Error('inputFrame and outputFrame must be arrays');}// set this back to true where appropriate if we add removeExample etc methods
if(!this.inputDimension||!this.outputDimension){this.inputDimension=inputVector.length;this.outputDimension=outputVector?outputVector.length:0;// this._empty = false;
}else if(inputVector.length!=this.inputDimension||outputVector.length!=this.outputDimension){throw new Error('dimensions mismatch');}}},{key:'length',get:function get(){return this.data.length;}}]);return TrainingSet;}();exports.default=TrainingSet;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImlzQXJyYXkiLCJ2IiwiY29uc3RydWN0b3IiLCJGbG9hdDMyQXJyYXkiLCJGbG9hdDY0QXJyYXkiLCJBcnJheSIsIlRyYWluaW5nU2V0IiwiaW5wdXREaW1lbnNpb24iLCJvdXRwdXREaW1lbnNpb24iLCJjb2x1bW5OYW1lcyIsImZpeGVkRGltZW5zaW9ucyIsImNsZWFyIiwiZGF0YSIsImV4YW1wbGUiLCJlIiwicGF5bG9hZCIsIl9jaGVja0RpbWVuc2lvbnMiLCJpbnB1dCIsIm91dHB1dCIsImxlbmd0aCIsIkVycm9yIiwicHVzaCIsImxhYmVsIiwidHJhaW5pbmdTZXQiLCJleGFtcGxlcyIsImkiLCJzZXQiLCJkb2NUeXBlIiwiZG9jVmVyc2lvbiIsIlJBUElEX01JWF9ET0NfVkVSU0lPTiIsImxhYmVscyIsImluZGV4T2YiLCJzb3J0IiwiZmlsdGVyIiwiZGF0dW0iLCJpbmRleCIsInNwbGljZSIsImlucHV0VmVjdG9yIiwib3V0cHV0VmVjdG9yIl0sIm1hcHBpbmdzIjoiZ1VBQUEsb0QsaUVBQ0Esa0Msa0lBRUE7QUFDQSxHQUFNQSxTQUFVLFFBQVZBLFFBQVUsR0FBSyxDQUNuQixNQUFPQyxHQUFFQyxXQUFGLEdBQWtCQyxZQUFsQixFQUNBRixFQUFFQyxXQUFGLEdBQWtCRSxZQURsQixFQUVBQyxNQUFNTCxPQUFOLENBQWNDLENBQWQsQ0FGUCxDQUdELENBSkQsQ0FNQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7TUEyQk1LLFksWUFDSixzQkFBNkUsSUFBakVDLGVBQWlFLDJEQUFoRCxJQUFnRCxJQUExQ0MsZ0JBQTBDLDJEQUF4QixJQUF3QixJQUFsQkMsWUFBa0IsMkRBQUosRUFBSSxnREFDM0UsR0FBSUYsaUJBQW1CLElBQXZCLENBQTZCLENBQzNCLEtBQUtHLGVBQUwsQ0FBdUIsSUFBdkIsQ0FDQSxLQUFLSCxjQUFMLENBQXNCQSxjQUF0QixDQUNBLEtBQUtDLGVBQUwsQ0FBdUJBLGtCQUFvQixJQUFw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QyxPQUFNWixLQUFOLEdBQWdCQSxLQUF6QixFQUFqQixDQUFaLENBQ0QsQ0FFRDs7Ozt1RUFLcUJhLEssQ0FBTyxDQUMxQixLQUFLdkIsSUFBTCxDQUFVd0IsTUFBVixDQUFpQkQsS0FBakIsQ0FBd0IsQ0FBeEIsRUFDRCxDQUVELGUsMERBQ2lCRSxXLENBQWFDLFksQ0FBYyxDQUMxQyxHQUFJLENBQUN0QyxRQUFRcUMsV0FBUixDQUFELEVBQTBCQyxjQUFnQixDQUFDdEMsUUFBUXNDLFlBQVIsQ0FBL0MsQ0FBdUUsQ0FDckUsS0FBTSxJQUFJbEIsTUFBSixDQUFVLDJDQUFWLENBQU4sQ0FDRCxDQUNEO0FBQ0EsR0FBSSxDQUFDLEtBQUtiLGNBQU4sRUFBd0IsQ0FBQyxLQUFLQyxlQUFsQyxDQUFtRCxDQUNqRCxLQUFLRCxjQUFMLENBQXNCOEIsWUFBWWxCLE1BQWxDLENBQ0EsS0FBS1gsZUFBTCxDQUF1QjhCLGFBQWVBLGFBQWFuQixNQUE1QixDQUFxQyxDQUE1RCxDQUNBO0FBQ0QsQ0FKRCxJQUlPLElBQUlrQixZQUFZbEIsTUFBWixFQUFzQixLQUFLWixjQUEzQixFQUNBK0IsYUFBYW5CLE1BQWIsRUFBdUIsS0FBS1gsZUFEaEMsQ0FDaUQsQ0FDdEQsS0FBTSxJQUFJWSxNQUFKLENBQVUscUJBQVYsQ0FBTixDQUNELENBQ0YsQyxrQ0E5SVksQ0FDWCxNQUFPLE1BQUtSLElBQUwsQ0FBVU8sTUFBakIsQ0FDRCxDLDJDQStJWWIsVyIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCByYXBpZE1peEFkYXB0ZXJzIGZyb20gJ3JhcGlkLW1peC1hZGFwdGVycyc7XG5pbXBvcnQgRXhhbXBsZSBmcm9tICcuL0V4YW1wbGUnO1xuXG4vLyBzb3VyY2UgOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNTI1MTg3OS9ob3ctdG8tY2hlY2staWYtYS12YXJpYWJsZS1pcy1hLXR5cGVkLWFycmF5LWluLWphdmFzY3JpcHRcbmNvbnN0IGlzQXJyYXkgPSB2ID0+IHtcbiAgcmV0dXJuIHYuY29uc3RydWN0b3IgPT09IEZsb2F0MzJBcnJheSB8fFxuICAgICAgICAgdi5jb25zdHJ1Y3RvciA9PT0gRmxvYXQ2NEFycmF5IHx8XG4gICAgICAgICBBcnJheS5pc0FycmF5KHYpO1xufTtcblxuLyoqXG4gKiBNYW5hZ2UgYW5kIGZvcm1hdCBhIHNldCBvZiByZWNvcmRlZCBleGFtcGxlcywgbWFpbnRhaW4gYSBSYXBpZE1peCBjb21wbGlhbnRcbiAqIHRyYWluaW5nIHNldC5cbiAqXG4gKiBAcGFyYW0ge051bWJlcn0gW2lucHV0RGltZW5zaW9uPW51bGxdIC0gSW5wdXQgZGltZW5zaW9uXG4gKiAgKGlmIGBudWxsYCwgaXMgZ3Vlc3NlZCBmcm9tIHRoZSBmaXJzdCByZWNvcmRlZCBlbGVtZW50KVxuICogQHBhcmFtIHtOdW1iZXJ9IFtvdXRwdXREaW1lbnNpb249bnVsbF0gLSBPdXRwdXQgZGltZW5zaW9uLlxuICogIChpZiBgbnVsbGAsIGlzIGd1ZXNzZWQgZnJvbSB0aGUgZmlyc3QgcmVjb3JkZWQgZWxlbWVudCkuXG4gKlxuICogQGV4YW1wbGVcbiAqIGltcG9ydCAqIGFzIG1hbm8gZnJvbSAnbWFuby1qcy9jbGllbnQnO1xuICpcbiAqIGNvbnN0IGV4YW1wbGUgPSBuZXcgbWFuby5FeGFtcGxlKCk7XG4gKiBjb25zdCB0cmFpbmluZ1NldCA9IG5ldyBtYW5vLlRyYWluaW5nU2V0KCk7XG4gKiBjb25zdCB4bW1Qcm9jZXNzb3IgPSBuZXcgbWFuby5YbW1Qcm9jZXNzc29yKCk7XG4gKlxuICogZXhhbXBsZS5zZXRMYWJlbCgndGVzdCcpO1xuICogZXhhbXBsZS5hZGRFbGVtZW50KFswLCAxLCAyLCAzXSk7XG4gKiBjb25zdCByYXBpZE1peEpzb25FeGFtcGxlID0gZXhhbXBsZS50b0pTT04oKTtcbiAqXG4gKiB0cmFpbmluZ1NldC5hZGRFeGFtcGxlKHJhcGlkTWl4SnNvbkV4YW1wbGUpO1xuICogY29uc3QgcmFwaWRNaXhKc29uVHJhaW5pbmdTZXQgPSB0cmFpbmluZ1NldC50b0pTT04oKTtcbiAqXG4gKiB4bW1Qcm9jZXNzb3JcbiAqICAgLnRyYWluKHJhcGlkTWl4SnNvblRyYWluaW5nU2V0KVxuICogICAudGhlbigoKSA9PiB7IC4uLiB9KTtcbiAqL1xuY2xhc3MgVHJhaW5pbmdTZXQge1xuICBjb25zdHJ1Y3RvcihpbnB1dERpbWVuc2lvbiA9IG51bGwsIG91dHB1dERpbWVuc2lvbiA9IG51bGwsIGNvbHVtbk5hbWVzID0gW10pIHtcbiAgICBpZiAoaW5wdXREaW1lbnNpb24gIT09IG51bGwpIHtcbiAgICAgIHRoaXMuZml4ZWREaW1lbnNpb25zID0gdHJ1ZTtcbiAgICAgIHRoaXMuaW5wdXREaW1lbnNpb24gPSBpbnB1dERpbWVuc2lvbjtcbiAgICAgIHRoaXMub3V0cHV0RGltZW5zaW9uID0gb3V0cHV0RGltZW5zaW9uICE9PSBudWxsID8gb3V0cHV0RGltZW5zaW9uIDogMDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5maXhlZERpbWVuc2lvbnMgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbHVtbk5hbWVzID0gY29sdW1uTmFtZXM7XG4gICAgdGhpcy5jbGVhcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgbnVtYmVyIG9mIGV4YW1wbGVzLlxuICAgKi9cbiAgZ2V0IGxlbmd0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmxlbmd0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciB0aGUgdHJhaW5pbmcgc2V0LlxuICAgKi9cbiAgY2xlYXIoKSB7XG4gICAgaWYgKCF0aGlzLmZpeGVkRGltZW5zaW9ucykge1xuICAgICAgdGhpcy5pbnB1dERpbWVuc2lvbiA9IG51bGw7XG4gICAgICB0aGlzLm91dHB1dERpbWVuc2lvbiA9IG51bGw7XG4gICAgfVxuXG4gICAgdGhpcy5kYXRhID0gW107XG4gIH1cblxuICAvKipcbiAgICogQWRkIGFuIGV4YW1wbGUgdG8gdGhlIHRyYWluaW5nIHNldC5cbiAgICpcbiAgICogQHBhcmFtIHtKU09OfSBleGFtcGxlIC0gQSBSYXBpZE1peCBmb3JtYXR0ZWQgZXhhbXBsZS5cbiAgICovXG4gIGFkZEV4YW1wbGUoZXhhbXBsZSkge1xuICAgIGNvbnN0IGUgPSBleGFtcGxlLnBheWxvYWQ7XG4gICAgdGhpcy5fY2hlY2tEaW1lbnNpb25zKGUuaW5wdXRbMF0sIGUub3V0cHV0WzBdKTtcblxuICAgIGlmIChlLmlucHV0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdleGFtcGxlcyBtdXN0IGNvbnRhaW4gYXQgbGVhc3Qgb25lIGlucHV0IHZlY3RvcicpO1xuICAgIH1cblxuICAgIHRoaXMuZGF0YS5wdXNoKHtcbiAgICAgIGxhYmVsOiBlLmxhYmVsLFxuICAgICAgaW5wdXQ6IGUuaW5wdXQsXG4gICAgICBvdXRwdXQ6IGUub3V0cHV0LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbGwgZXhhbXBsZXMgZnJvbSBhbm90aGVyIFJhcGlkTWl4IEpTT04gdHJhaW5pbmcgc2V0LlxuICAgKlxuICAgKiBAcGFyYW0ge0pTT059IHRyYWluaW5nU2V0IC0gQSBSYXBpZE1peCBjb21wbGlhbnQgdHJhaW5pbmcgc2V0LlxuICAgKi9cbiAgYWRkVHJhaW5pbmdTZXQodHJhaW5pbmdTZXQpIHtcbiAgICBjb25zdCBleGFtcGxlcyA9IHRyYWluaW5nU2V0LnBheWxvYWQuZGF0YTtcbiAgICBsZXQgZSA9IGV4YW1wbGVzWzBdO1xuICAgIHRoaXMuX2NoZWNrRGltZW5zaW9ucyhlLmlucHV0WzBdLCBlLm91dHB1dFswXSk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV4YW1wbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBlID0gZXhhbXBsZXNbaV07XG5cbiAgICAgIHRoaXMuZGF0YS5wdXNoKHtcbiAgICAgICAgbGFiZWw6IGUubGFiZWwsXG4gICAgICAgIGlucHV0OiBlLmlucHV0LFxuICAgICAgICBvdXRwdXQ6IGUub3V0cHV0LFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgZnJvbSBhbm90aGVyIFJhcGlkTWl4IEpTT04gdHJhaW5pbmcgc2V0LiBJZiBgbnVsbGAsIGNsZWFyIHRoZVxuICAgKiB0cmFpbmluZ1NldC5cbiAgICpcbiAgICogQHBhcmFtIHtKU09OfSB0cmFpbmluZ1NldCAtIEEgUmFwaWRNaXggY29tcGxpYW50IHRyYWluaW5nIHNldC5cbiAgICovXG4gIHNldFRyYWluaW5nU2V0KHRyYWluaW5nU2V0ID0gbnVsbCkge1xuICAgIGlmICh0cmFpbmluZ1NldCA9PT0gbnVsbClcbiAgICAgIHJldHVybiB0aGlzLmNsZWFyKCk7XG5cbiAgICBjb25zdCBzZXQgPSB0cmFpbmluZ1NldC5wYXlsb2FkO1xuXG4gICAgdGhpcy5pbnB1dERpbWVuc2lvbiA9IHNldC5pbnB1dERpbWVuc2lvbjtcbiAgICB0aGlzLm91dHB1dERpbWVuc2lvbiA9IHNldC5vdXRwdXREaW1lbnNpb247XG4gICAgdGhpcy5kYXRhID0gc2V0LmRhdGE7XG4gICAgdGhpcy5jb2x1bW5OYW1lcyA9IHNldC5jb2x1bW5OYW1lcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIFJhcGlkTWl4IGNvbXBsaWFudCB0cmFpbmluZyBzZXQgaW4gSlNPTiBmb3JtYXQuXG4gICAqXG4gICAqIEByZXR1cm4ge0pTT059IC0gVHJhaW5pbmcgc2V0LlxuICAgKi9cbiAgdG9KU09OKCkge1xuICAgIHJldHVybiB7XG4gICAgICBkb2NUeXBlOiAncmFwaWQtbWl4OnRyYWluaW5nLXNldCcsXG4gICAgICBkb2NWZXJzaW9uOiByYXBpZE1peEFkYXB0ZXJzLlJBUElEX01JWF9ET0NfVkVSU0lPTixcbiAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgaW5wdXREaW1lbnNpb246IHRoaXMuaW5wdXREaW1lbnNpb24sXG4gICAgICAgIG91dHB1dERpbWVuc2lvbjogdGhpcy5vdXRwdXREaW1lbnNpb24sXG4gICAgICAgIGRhdGE6IHRoaXMuZGF0YSxcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhbiBhcnJheSBvZiB0aGUgY3VycmVudCB0cmFpbmluZyBzZXQgbGFiZWxzLlxuICAgKlxuICAgKiBAcmV0dXJuIHtBcnJheS5TdHJpbmd9IC0gVHJhaW5pbmcgc2V0IHNvcnRlZCBsYWJlbHMuXG4gICAqL1xuICBnZXRMYWJlbHMoKSB7XG4gICAgY29uc3QgbGFiZWxzID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLmRhdGFbaV0ubGFiZWw7XG5cbiAgICAgIGlmIChsYWJlbHMuaW5kZXhPZihsYWJlbCkgPT09IC0xKVxuICAgICAgICBsYWJlbHMucHVzaChsYWJlbCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGxhYmVscy5zb3J0KCk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGFsbCBleGFtcGxlcyBvZiBhIGNlcnRhaW4gbGFiZWwuXG4gICAqXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCAtIFRoZSBsYWJlbCBvZiB0aGUgcmVjb3JkaW5ncyB0byBiZSByZW1vdmVkLlxuICAgKi9cbiAgcmVtb3ZlRXhhbXBsZXNCeUxhYmVsKGxhYmVsKSB7XG4gICAgdGhpcy5kYXRhID0gdGhpcy5kYXRhLmZpbHRlcihkYXR1bSA9PiBkYXR1bS5sYWJlbCAhPT0gbGFiZWwpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBleGFtcGxlIGF0IGluZGV4LlxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggb2YgdGhlIGV4YW1wbGUgdG8gcmVtb3ZlLlxuICAgKi9cbiAgcmVtb3ZlRXhhbXBsZUF0SW5kZXgoaW5kZXgpIHtcbiAgICB0aGlzLmRhdGEuc3BsaWNlKGluZGV4LCAxKTtcbiAgfVxuXG4gIC8qKiBAcHJpdmF0ZSAqL1xuICBfY2hlY2tEaW1lbnNpb25zKGlucHV0VmVjdG9yLCBvdXRwdXRWZWN0b3IpwqB7XG4gICAgaWYgKCFpc0FycmF5KGlucHV0VmVjdG9yKSB8fCAob3V0cHV0VmVjdG9yICYmICFpc0FycmF5KG91dHB1dFZlY3RvcikpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2lucHV0RnJhbWUgYW5kIG91dHB1dEZyYW1lIG11c3QgYmUgYXJyYXlzJyk7XG4gICAgfVxuICAgIC8vIHNldCB0aGlzIGJhY2sgdG8gdHJ1ZSB3aGVyZSBhcHByb3ByaWF0ZSBpZiB3ZSBhZGQgcmVtb3ZlRXhhbXBsZSBldGMgbWV0aG9kc1xuICAgIGlmICghdGhpcy5pbnB1dERpbWVuc2lvbiB8fCAhdGhpcy5vdXRwdXREaW1lbnNpb24pIHtcbiAgICAgIHRoaXMuaW5wdXREaW1lbnNpb24gPSBpbnB1dFZlY3Rvci5sZW5ndGg7XG4gICAgICB0aGlzLm91dHB1dERpbWVuc2lvbiA9IG91dHB1dFZlY3RvciA/IG91dHB1dFZlY3Rvci5sZW5ndGggOiAwO1xuICAgICAgLy8gdGhpcy5fZW1wdHkgPSBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKGlucHV0VmVjdG9yLmxlbmd0aCAhPSB0aGlzLmlucHV0RGltZW5zaW9uIHx8XG4gICAgICAgICAgICAgICBvdXRwdXRWZWN0b3IubGVuZ3RoICE9IHRoaXMub3V0cHV0RGltZW5zaW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RpbWVuc2lvbnMgbWlzbWF0Y2gnKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVHJhaW5pbmdTZXQ7XG4iXX0=