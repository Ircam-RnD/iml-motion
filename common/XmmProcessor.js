'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _isInteger=require('babel-runtime/core-js/number/is-integer');var _isInteger2=_interopRequireDefault(_isInteger);var _keys=require('babel-runtime/core-js/object/keys');var _keys2=_interopRequireDefault(_keys);var _getIterator2=require('babel-runtime/core-js/get-iterator');var _getIterator3=_interopRequireDefault(_getIterator2);var _from=require('babel-runtime/core-js/array/from');var _from2=_interopRequireDefault(_from);var _stringify=require('babel-runtime/core-js/json/stringify');var _stringify2=_interopRequireDefault(_stringify);var _promise=require('babel-runtime/core-js/promise');var _promise2=_interopRequireDefault(_promise);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _xmlhttprequest=require('xmlhttprequest');var _xmmClient=require('xmm-client');var Xmm=_interopRequireWildcard(_xmmClient);var _rapidMixAdapters=require('rapid-mix-adapters');function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}// import { translators as rapidMixTranslators } from 'rapid-mix-adapters';
var isNode=new Function("try {return this===global;}catch(e){return false;}");var knownTargets={xmm:['gmm','gmr','hhmm','hhmr']};var defaultXmmConfig={modelType:'gmm',gaussians:1,absoluteRegularization:0.01,relativeRegularization:0.01,covarianceMode:'full',hierarchical:true,states:1,transitionMode:'leftright',regressionEstimator:'full',likelihoodWindow:10};/**
 * Representation of a gesture model. A instance of `XmmProcessor` can
 * train a model from examples and can perform classification and/or
 * regression depending on the chosen algorithm.
 *
 * The training is currently based on the presence of a remote server-side
 * API, that must be able to process rapidMix compliant JSON formats.
 *
 * @param {Object} options - Override default parameters
 * @param {String} [options.url='https://como.ircam.fr/api/v1/train'] - Url
 *  of the training end point.
 */var XmmProcessor=function(){function XmmProcessor(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$url=_ref.url,url=_ref$url===undefined?'https://como.ircam.fr/api/v1/train':_ref$url;(0,_classCallCheck3.default)(this,XmmProcessor);this.url=url;this._config={};this._decoder=null;this._model=null;this._modelType=null;this._likelihoodWindow=null;this.setConfig(defaultXmmConfig);this._updateDecoder();}(0,_createClass3.default)(XmmProcessor,[{key:'_updateDecoder',value:function _updateDecoder(){switch(this._modelType){case'hhmm':this._decoder=new Xmm.HhmmDecoder(this._likelihoodWindow);break;case'gmm':default:this._decoder=new Xmm.GmmDecoder(this._likelihoodWindow);break;}}/**
   * Train the model according to the given `TrainingSet`. In this implmentation
   * the training is performed server-side and rely on an XHR call.
   *
   * @param {JSON} trainingSet - RapidMix compliant JSON formatted training set
   * @return {Promise} - Promise that resolves on the API response (RapidMix API
   *  response format), when the model is updated.
   */},{key:'train',value:function train(trainingSet){var _this=this;// REST request / response - RapidMix
return new _promise2.default(function(resolve,reject){var trainingData={docType:'rapid-mix:ml:http-request',docVersion:_rapidMixAdapters.constants.rapidMixDocVersion,configuration:_this.getConfig(),trainingSet:trainingSet};var xhr=isNode()?new _xmlhttprequest.XMLHttpRequest():new XMLHttpRequest();xhr.open('post',_this.url,true);xhr.responseType='json';xhr.setRequestHeader('Access-Control-Allow-Origin','*');xhr.setRequestHeader('Content-Type','application/json');var errorMsg='an error occured while training the model. ';if(isNode()){// XMLHttpRequest module only supports xhr v1
xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){var body=JSON.parse(xhr.responseText);_this._decoder.setModel(body.model.payload);_this._model=body.model;resolve(body);}else{throw new Error(errorMsg+('response : '+xhr.status+' - '+xhr.responseText));}}};}else{// use xhr v2
xhr.onload=function(){if(xhr.status===200){var body=xhr.response;_this._decoder.setModel(body.model.payload);_this._model=body.model;resolve(body);}else{throw new Error(errorMsg+('response : '+xhr.status+' - '+xhr.response));}};xhr.onerror=function(){throw new Error(errorMsg+('response : '+xhr.status+' - '+xhr.response));};}xhr.send((0,_stringify2.default)(trainingData));});}/**
   * Perform the calssification or the regression of the given vector.
   *
   * @param {Float32Array|Array} vector - Input vector for the decoding.
   * @return {Object} results - Object containing the decoding results.
   */},{key:'run',value:function run(vector){if(vector instanceof Float32Array||vector instanceof Float64Array){vector=(0,_from2.default)(vector);}return this._decoder.filter(vector);}/**
   * Reset the inner model's decoding state.
   */},{key:'reset',value:function reset(){if(this._decoder.reset){this._decoder.reset();}}/**
   * Set the model configuration parameters (or a subset of them).
   *
   * @param {Object} config - RapidMix configuration object (or payload), or subset of parameters.
   */},{key:'setConfig',value:function setConfig(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!config)return;// replace later by isValidRapidMixConfiguration (modelType shouldn't be allowed in payload)
if(config.docType==='rapid-mix:ml:configuration'&&config.docVersion&&config.payload&&config.target&&config.target.name&&config.target.name.split(':')[0]==='xmm'){var target=config.target.name.split(':');config=config.payload;if(target.length>1&&knownTargets.xmm.indexOf(target[1])>-1){if(this._modelType!==target[1]){this._modelType=target[1];this._updateDecoder();}}}if(config.modelType&&knownTargets['xmm'].indexOf(config.modelType)>-1){var val=config.modelType;var newModel=val==='gmr'?'gmm':val==='hhmr'?'hhmm':val;if(newModel!==this._modelType){this._modelType=newModel;this._updateDecoder();}}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=(0,_getIterator3.default)((0,_keys2.default)(config)),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;var _val=config[key];if(key==='gaussians'&&(0,_isInteger2.default)(_val)&&_val>0||key==='absoluteRegularization'&&typeof _val==='number'&&_val>0||key==='relativeRegularization'&&typeof _val==='number'&&_val>0||key==='covarianceMode'&&typeof _val==='string'&&['full','diagonal'].indexOf(_val)>-1||key==='hierarchical'&&typeof _val==='boolean'||key==='states'&&(0,_isInteger2.default)(_val)&&_val>0||key==='transitionMode'&&typeof _val==='string'&&['leftright','ergodic'].indexOf(_val)>-1||key==='regressionEstimator'&&typeof _val==='string'&&['full','windowed','likeliest'].indexOf(_val)>-1){this._config[key]=_val;}else if(key==='likelihoodWindow'&&(0,_isInteger2.default)(_val)&&_val>0){this._likelihoodWindow=_val;if(this._decoder!==null){this._decoder.setLikelihoodWindow(this._likelihoodWindow);}}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}}/**
   * RapidMix compliant configuration object.
   *
   * @return {Object} - RapidMix Configuration object.
   */},{key:'getConfig',value:function getConfig(){return{docType:'rapid-mix:ml:configuration',docVersion:_rapidMixAdapters.constants.rapidMixDocVersion,target:{name:'xmm:'+this._modelType,version:'1.0.0'},payload:this._config};}/**
   * Use the given RapidMix model object for the decoding.
   *
   * @param {Object} model - RapidMix Model object.
   */},{key:'setModel',value:function setModel(model){if(!model){this.model=null;this._decoder.setModel(null);return;}var targets=model.target.name.split(':');if(targets[0]==='xmm')this._modelType=targets[1]==='hhmm'?targets[1]:'gmm';this._updateDecoder();this._model=model;this._decoder.setModel(model.payload);}/**
   * Retrieve the model in RapidMix model format.
   *
   * @return {Object} - Current RapidMix Model object.
   */},{key:'getModel',value:function getModel(){return this._model;}}]);return XmmProcessor;}();exports.default=XmmProcessor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRvcnMuanMiXSwibmFtZXMiOlsiWG1tIiwiaXNOb2RlIiwiRnVuY3Rpb24iLCJrbm93blRhcmdldHMiLCJ4bW0iLCJkZWZhdWx0WG1tQ29uZmlnIiwibW9kZWxUeXBlIiwiZ2F1c3NpYW5zIiwiYWJzb2x1dGVSZWd1bGFyaXphdGlvbiIsInJlbGF0aXZlUmVndWxhcml6YXRpb24iLCJjb3ZhcmlhbmNlTW9kZSIsImhpZXJhcmNoaWNhbCIsInN0YXRlcyIsInRyYW5zaXRpb25Nb2RlIiwicmVncmVzc2lvbkVzdGltYXRvciIsImxpa2VsaWhvb2RXaW5kb3ciLCJYbW1Qcm9jZXNzb3IiLCJ1cmwiLCJfY29uZmlnIiwiX2RlY29kZXIiLCJfbW9kZWwiLCJfbW9kZWxUeXBlIiwiX2xpa2VsaWhvb2RXaW5kb3ciLCJzZXRDb25maWciLCJfdXBkYXRlRGVjb2RlciIsIkhobW1EZWNvZGVyIiwiR21tRGVjb2RlciIsInRyYWluaW5nU2V0IiwicmVzb2x2ZSIsInJlamVjdCIsInRyYWluaW5nRGF0YSIsImRvY1R5cGUiLCJkb2NWZXJzaW9uIiwicmFwaWRNaXhEb2NWZXJzaW9uIiwiY29uZmlndXJhdGlvbiIsImdldENvbmZpZyIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInJlc3BvbnNlVHlwZSIsInNldFJlcXVlc3RIZWFkZXIiLCJlcnJvck1zZyIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJib2R5IiwiSlNPTiIsInBhcnNlIiwicmVzcG9uc2VUZXh0Iiwic2V0TW9kZWwiLCJtb2RlbCIsInBheWxvYWQiLCJFcnJvciIsIm9ubG9hZCIsInJlc3BvbnNlIiwib25lcnJvciIsInNlbmQiLCJ2ZWN0b3IiLCJGbG9hdDMyQXJyYXkiLCJGbG9hdDY0QXJyYXkiLCJmaWx0ZXIiLCJyZXNldCIsImNvbmZpZyIsInRhcmdldCIsIm5hbWUiLCJzcGxpdCIsImxlbmd0aCIsImluZGV4T2YiLCJ2YWwiLCJuZXdNb2Rl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LENBQ0YsQ0FDRixDQWxEb0IsK0xBbUR0QixDQUVEOzs7O2tEQUtZLENBQ1YsTUFBTyxDQUNMUyxRQUFTLDRCQURKLENBRUxDLFdBQVksNEJBQWtCQyxrQkFGekIsQ0FHTDhCLE9BQVEsQ0FDTkMsWUFBYSxLQUFLM0MsVUFEWixDQUVObUQsUUFBUyxPQUZILENBSEgsQ0FPTHJCLFFBQVMsS0FBS2pDLE9BUFQsQ0FBUCxDQVNELENBRUQ7Ozs7K0NBS1NnQyxLLENBQU8sQ0FDZCxHQUFJLENBQUNBLEtBQUwsQ0FBWSxDQUNWLEtBQUtBLEtBQUwsQ0FBYSxJQUFiLENBQ0EsS0FBSy9CLFFBQUwsQ0FBYzhCLFFBQWQsQ0FBdUIsSUFBdkIsRUFDQSxPQUNELENBRUQsR0FBTXdCLFNBQVV2QixNQUFNYSxNQUFOLENBQWFDLElBQWIsQ0FBa0JDLEtBQWxCLENBQXdCLEdBQXhCLENBQWhCLENBRUEsR0FBSVEsUUFBUSxDQUFSLElBQWUsS0FBbkIsQ0FDRSxLQUFLcEQsVUFBTCxDQUFrQm9ELFFBQVEsQ0FBUixJQUFlLE1BQWYsQ0FBd0JBLFFBQVEsQ0FBUixDQUF4QixDQUFxQyxLQUF2RCxDQUVGLEtBQUtqRCxjQUFMLEdBRUEsS0FBS0osTUFBTCxDQUFjOEIsS0FBZCxDQUNBLEtBQUsvQixRQUFMLENBQWM4QixRQUFkLENBQXVCQyxNQUFNQyxPQUE3QixFQUNELENBRUQ7Ozs7Z0RBS1csQ0FDVCxNQUFPLE1BQUsvQixNQUFaLENBQ0QsQyw0Q0FHWUosWSIsImZpbGUiOiJ2YWxpZGF0b3JzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgWE1MSHR0cFJlcXVlc3QgYXMgWEhSIH0gZnJvbSAneG1saHR0cHJlcXVlc3QnO1xuaW1wb3J0ICogYXMgWG1tIGZyb20gJ3htbS1jbGllbnQnO1xuaW1wb3J0IHsgY29uc3RhbnRzIGFzIHJhcGlkTWl4Q29uc3RhbnRzIH0gZnJvbSAncmFwaWQtbWl4LWFkYXB0ZXJzJztcbi8vIGltcG9ydCB7IHRyYW5zbGF0b3JzIGFzIHJhcGlkTWl4VHJhbnNsYXRvcnMgfSBmcm9tICdyYXBpZC1taXgtYWRhcHRlcnMnO1xuXG5jb25zdCBpc05vZGUgPSBuZXcgRnVuY3Rpb24oXCJ0cnkge3JldHVybiB0aGlzPT09Z2xvYmFsO31jYXRjaChlKXtyZXR1cm4gZmFsc2U7fVwiKTtcblxuY29uc3Qga25vd25UYXJnZXRzID0ge1xuICB4bW06IFsgJ2dtbScsICdnbXInLCAnaGhtbScsICdoaG1yJyBdXG59O1xuXG5jb25zdCBkZWZhdWx0WG1tQ29uZmlnID0ge1xuICBtb2RlbFR5cGU6ICdnbW0nLFxuICBnYXVzc2lhbnM6IDEsXG4gIGFic29sdXRlUmVndWxhcml6YXRpb246IDAuMDEsXG4gIHJlbGF0aXZlUmVndWxhcml6YXRpb246IDAuMDEsXG4gIGNvdmFyaWFuY2VNb2RlOiAnZnVsbCcsXG4gIGhpZXJhcmNoaWNhbDogdHJ1ZSxcbiAgc3RhdGVzOiAxLFxuICB0cmFuc2l0aW9uTW9kZTogJ2xlZnRyaWdodCcsXG4gIHJlZ3Jlc3Npb25Fc3RpbWF0b3I6ICdmdWxsJyxcbiAgbGlrZWxpaG9vZFdpbmRvdzogMTAsXG59O1xuXG4vKipcbiAqIFJlcHJlc2VudGF0aW9uIG9mIGEgZ2VzdHVyZSBtb2RlbC4gQSBpbnN0YW5jZSBvZiBgWG1tUHJvY2Vzc29yYCBjYW5cbiAqIHRyYWluIGEgbW9kZWwgZnJvbSBleGFtcGxlcyBhbmQgY2FuIHBlcmZvcm0gY2xhc3NpZmljYXRpb24gYW5kL29yXG4gKiByZWdyZXNzaW9uIGRlcGVuZGluZyBvbiB0aGUgY2hvc2VuIGFsZ29yaXRobS5cbiAqXG4gKiBUaGUgdHJhaW5pbmcgaXMgY3VycmVudGx5IGJhc2VkIG9uIHRoZSBwcmVzZW5jZSBvZiBhIHJlbW90ZSBzZXJ2ZXItc2lkZVxuICogQVBJLCB0aGF0IG11c3QgYmUgYWJsZSB0byBwcm9jZXNzIHJhcGlkTWl4IGNvbXBsaWFudCBKU09OIGZvcm1hdHMuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBPdmVycmlkZSBkZWZhdWx0IHBhcmFtZXRlcnNcbiAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy51cmw9J2h0dHBzOi8vY29tby5pcmNhbS5mci9hcGkvdjEvdHJhaW4nXSAtIFVybFxuICogIG9mIHRoZSB0cmFpbmluZyBlbmQgcG9pbnQuXG4gKi9cbmNsYXNzIFhtbVByb2Nlc3NvciB7XG4gIGNvbnN0cnVjdG9yKHtcbiAgICB1cmwgPSAnaHR0cHM6Ly9jb21vLmlyY2FtLmZyL2FwaS92MS90cmFpbicsXG4gIH0gPSB7fSkge1xuICAgIHRoaXMudXJsID0gdXJsO1xuXG4gICAgdGhpcy5fY29uZmlnID0ge307XG4gICAgdGhpcy5fZGVjb2RlciA9IG51bGw7XG4gICAgdGhpcy5fbW9kZWwgPSBudWxsO1xuICAgIHRoaXMuX21vZGVsVHlwZSA9IG51bGw7XG4gICAgdGhpcy5fbGlrZWxpaG9vZFdpbmRvdyA9IG51bGw7XG5cbiAgICB0aGlzLnNldENvbmZpZyhkZWZhdWx0WG1tQ29uZmlnKTtcbiAgICB0aGlzLl91cGRhdGVEZWNvZGVyKCk7XG4gIH1cblxuICBfdXBkYXRlRGVjb2RlcigpIHtcbiAgICBzd2l0Y2ggKHRoaXMuX21vZGVsVHlwZSkge1xuICAgICAgY2FzZSAnaGhtbSc6XG4gICAgICAgIHRoaXMuX2RlY29kZXIgPSBuZXcgWG1tLkhobW1EZWNvZGVyKHRoaXMuX2xpa2VsaWhvb2RXaW5kb3cpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2dtbSc6XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aGlzLl9kZWNvZGVyID0gbmV3IFhtbS5HbW1EZWNvZGVyKHRoaXMuX2xpa2VsaWhvb2RXaW5kb3cpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVHJhaW4gdGhlIG1vZGVsIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gYFRyYWluaW5nU2V0YC4gSW4gdGhpcyBpbXBsbWVudGF0aW9uXG4gICAqIHRoZSB0cmFpbmluZyBpcyBwZXJmb3JtZWQgc2VydmVyLXNpZGUgYW5kIHJlbHkgb24gYW4gWEhSIGNhbGwuXG4gICAqXG4gICAqIEBwYXJhbSB7SlNPTn0gdHJhaW5pbmdTZXQgLSBSYXBpZE1peCBjb21wbGlhbnQgSlNPTiBmb3JtYXR0ZWQgdHJhaW5pbmcgc2V0XG4gICAqIEByZXR1cm4ge1Byb21pc2V9IC0gUHJvbWlzZSB0aGF0IHJlc29sdmVzIG9uIHRoZSBBUEkgcmVzcG9uc2UgKFJhcGlkTWl4IEFQSVxuICAgKiAgcmVzcG9uc2UgZm9ybWF0KSwgd2hlbiB0aGUgbW9kZWwgaXMgdXBkYXRlZC5cbiAgICovXG4gIHRyYWluKHRyYWluaW5nU2V0KSB7XG4gICAgLy8gUkVTVCByZXF1ZXN0IC8gcmVzcG9uc2UgLSBSYXBpZE1peFxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCB0cmFpbmluZ0RhdGEgPSB7XG4gICAgICAgIGRvY1R5cGU6ICdyYXBpZC1taXg6bWw6aHR0cC1yZXF1ZXN0JyxcbiAgICAgICAgZG9jVmVyc2lvbjogcmFwaWRNaXhDb25zdGFudHMucmFwaWRNaXhEb2NWZXJzaW9uLFxuICAgICAgICBjb25maWd1cmF0aW9uOiB0aGlzLmdldENvbmZpZygpLFxuICAgICAgICB0cmFpbmluZ1NldDogdHJhaW5pbmdTZXRcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHhociA9IGlzTm9kZSgpID8gbmV3IFhIUigpIDogbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICAgIHhoci5vcGVuKCdwb3N0JywgdGhpcy51cmwsIHRydWUpO1xuICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdqc29uJztcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpO1xuICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cbiAgICAgIGNvbnN0IGVycm9yTXNnID0gJ2FuIGVycm9yIG9jY3VyZWQgd2hpbGUgdHJhaW5pbmcgdGhlIG1vZGVsLiAnO1xuXG4gICAgICBpZiAoaXNOb2RlKCkpIHsgLy8gWE1MSHR0cFJlcXVlc3QgbW9kdWxlIG9ubHkgc3VwcG9ydHMgeGhyIHYxXG4gICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICB0aGlzLl9kZWNvZGVyLnNldE1vZGVsKGJvZHkubW9kZWwucGF5bG9hZCk7XG4gICAgICAgICAgICAgIHRoaXMuX21vZGVsID0gYm9keS5tb2RlbDtcbiAgICAgICAgICAgICAgcmVzb2x2ZShib2R5KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1zZyArIGByZXNwb25zZSA6ICR7eGhyLnN0YXR1c30gLSAke3hoci5yZXNwb25zZVRleHR9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgeyAvLyB1c2UgeGhyIHYyXG4gICAgICAgIHhoci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgY29uc3QgYm9keSA9IHhoci5yZXNwb25zZTtcbiAgICAgICAgICAgIHRoaXMuX2RlY29kZXIuc2V0TW9kZWwoYm9keS5tb2RlbC5wYXlsb2FkKTtcbiAgICAgICAgICAgIHRoaXMuX21vZGVsID0gYm9keS5tb2RlbDtcbiAgICAgICAgICAgIHJlc29sdmUoYm9keSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1zZyArIGByZXNwb25zZSA6ICR7eGhyLnN0YXR1c30gLSAke3hoci5yZXNwb25zZX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgeGhyLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTXNnICsgYHJlc3BvbnNlIDogJHt4aHIuc3RhdHVzfSAtICR7eGhyLnJlc3BvbnNlfWApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KHRyYWluaW5nRGF0YSkpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gdGhlIGNhbHNzaWZpY2F0aW9uIG9yIHRoZSByZWdyZXNzaW9uIG9mIHRoZSBnaXZlbiB2ZWN0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7RmxvYXQzMkFycmF5fEFycmF5fSB2ZWN0b3IgLSBJbnB1dCB2ZWN0b3IgZm9yIHRoZSBkZWNvZGluZy5cbiAgICogQHJldHVybiB7T2JqZWN0fSByZXN1bHRzIC0gT2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRlY29kaW5nIHJlc3VsdHMuXG4gICAqL1xuICBydW4odmVjdG9yKSB7XG4gICAgaWYgKHZlY3RvciBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSB8fCB2ZWN0b3IgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpIHtcbiAgICAgIHZlY3RvciA9IEFycmF5LmZyb20odmVjdG9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fZGVjb2Rlci5maWx0ZXIodmVjdG9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCB0aGUgaW5uZXIgbW9kZWwncyBkZWNvZGluZyBzdGF0ZS5cbiAgICovXG4gIHJlc2V0KCkge1xuICAgIGlmICh0aGlzLl9kZWNvZGVyLnJlc2V0KSB7XG4gICAgICB0aGlzLl9kZWNvZGVyLnJlc2V0KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgbW9kZWwgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzIChvciBhIHN1YnNldCBvZiB0aGVtKS5cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyAtIFJhcGlkTWl4IGNvbmZpZ3VyYXRpb24gb2JqZWN0IChvciBwYXlsb2FkKSwgb3Igc3Vic2V0IG9mIHBhcmFtZXRlcnMuXG4gICAqL1xuICBzZXRDb25maWcoY29uZmlnID0ge30pIHtcbiAgICBpZiAoIWNvbmZpZylcbiAgICAgIHJldHVybjtcblxuICAgIC8vIHJlcGxhY2UgbGF0ZXIgYnkgaXNWYWxpZFJhcGlkTWl4Q29uZmlndXJhdGlvbiAobW9kZWxUeXBlIHNob3VsZG4ndCBiZSBhbGxvd2VkIGluIHBheWxvYWQpXG4gICAgaWYgKGNvbmZpZy5kb2NUeXBlID09PSAncmFwaWQtbWl4Om1sOmNvbmZpZ3VyYXRpb24nICYmIGNvbmZpZy5kb2NWZXJzaW9uICYmIGNvbmZpZy5wYXlsb2FkICYmXG4gICAgICAgIGNvbmZpZy50YXJnZXQgJiYgY29uZmlnLnRhcmdldC5uYW1lICYmIGNvbmZpZy50YXJnZXQubmFtZS5zcGxpdCgnOicpWzBdID09PSAneG1tJykge1xuXG4gICAgICBjb25zdCB0YXJnZXQgPSBjb25maWcudGFyZ2V0Lm5hbWUuc3BsaXQoJzonKTtcbiAgICAgIGNvbmZpZyA9IGNvbmZpZy5wYXlsb2FkO1xuICAgICAgaWYgKHRhcmdldC5sZW5ndGggPiAxICYmIGtub3duVGFyZ2V0cy54bW0uaW5kZXhPZih0YXJnZXRbMV0pID4gLTEpIHtcbiAgICAgICAgaWYgKHRoaXMuX21vZGVsVHlwZSAhPT0gdGFyZ2V0WzFdKSB7XG4gICAgICAgICAgdGhpcy5fbW9kZWxUeXBlID0gdGFyZ2V0WzFdO1xuICAgICAgICAgIHRoaXMuX3VwZGF0ZURlY29kZXIoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjb25maWcubW9kZWxUeXBlICYmIGtub3duVGFyZ2V0c1sneG1tJ10uaW5kZXhPZihjb25maWcubW9kZWxUeXBlKSA+IC0xKSB7XG4gICAgICBjb25zdCB2YWwgPSBjb25maWcubW9kZWxUeXBlO1xuICAgICAgY29uc3QgbmV3TW9kZWwgPSAodmFsID09PSAnZ21yJykgPyAnZ21tJyA6ICgodmFsID09PSAnaGhtcicpID8gJ2hobW0nIDogdmFsKTtcblxuICAgICAgaWYgKG5ld01vZGVsICE9PSB0aGlzLl9tb2RlbFR5cGUpIHtcbiAgICAgICAgdGhpcy5fbW9kZWxUeXBlID0gbmV3TW9kZWw7XG4gICAgICAgIHRoaXMuX3VwZGF0ZURlY29kZXIoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKGxldCBrZXkgb2YgT2JqZWN0LmtleXMoY29uZmlnKSkge1xuICAgICAgY29uc3QgdmFsID0gY29uZmlnW2tleV07XG5cbiAgICAgIGlmICgoa2V5ID09PSAnZ2F1c3NpYW5zJyAmJiBOdW1iZXIuaXNJbnRlZ2VyKHZhbCkgJiYgdmFsID4gMCkgfHxcbiAgICAgICAgICAoa2V5ID09PSAnYWJzb2x1dGVSZWd1bGFyaXphdGlvbicgJiYgdHlwZW9mIHZhbCA9PT0gJ251bWJlcicgJiYgdmFsID4gMCkgfHxcbiAgICAgICAgICAoa2V5ID09PSAncmVsYXRpdmVSZWd1bGFyaXphdGlvbicgJiYgdHlwZW9mIHZhbCA9PT0gJ251bWJlcicgJiYgdmFsID4gMCkgfHxcbiAgICAgICAgICAoa2V5ID09PSAnY292YXJpYW5jZU1vZGUnICYmIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICBbJ2Z1bGwnLCAnZGlhZ29uYWwnXS5pbmRleE9mKHZhbCkgPiAtMSkgfHxcbiAgICAgICAgICAoa2V5ID09PSAnaGllcmFyY2hpY2FsJyAmJiB0eXBlb2YgdmFsID09PSAnYm9vbGVhbicpIHx8XG4gICAgICAgICAgKGtleSA9PT0gJ3N0YXRlcycgJiYgTnVtYmVyLmlzSW50ZWdlcih2YWwpICYmIHZhbCA+IDApIHx8XG4gICAgICAgICAgKGtleSA9PT0gJ3RyYW5zaXRpb25Nb2RlJyAmJiB0eXBlb2YgdmFsID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgICAgWydsZWZ0cmlnaHQnLCAnZXJnb2RpYyddLmluZGV4T2YodmFsKSA+IC0xKSB8fFxuICAgICAgICAgIChrZXkgPT09ICdyZWdyZXNzaW9uRXN0aW1hdG9yJyAmJiB0eXBlb2YgdmFsID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgICAgWydmdWxsJywgJ3dpbmRvd2VkJywgJ2xpa2VsaWVzdCddLmluZGV4T2YodmFsKSA+IC0xKSkge1xuICAgICAgICB0aGlzLl9jb25maWdba2V5XSA9IHZhbDtcbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnbGlrZWxpaG9vZFdpbmRvdycgJiYgTnVtYmVyLmlzSW50ZWdlcih2YWwpICYmIHZhbCA+IDApIHtcbiAgICAgICAgdGhpcy5fbGlrZWxpaG9vZFdpbmRvdyA9IHZhbDtcblxuICAgICAgICBpZiAodGhpcy5fZGVjb2RlciAhPT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMuX2RlY29kZXIuc2V0TGlrZWxpaG9vZFdpbmRvdyh0aGlzLl9saWtlbGlob29kV2luZG93KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSYXBpZE1peCBjb21wbGlhbnQgY29uZmlndXJhdGlvbiBvYmplY3QuXG4gICAqXG4gICAqIEByZXR1cm4ge09iamVjdH0gLSBSYXBpZE1peCBDb25maWd1cmF0aW9uIG9iamVjdC5cbiAgICovXG4gIGdldENvbmZpZygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZG9jVHlwZTogJ3JhcGlkLW1peDptbDpjb25maWd1cmF0aW9uJyxcbiAgICAgIGRvY1ZlcnNpb246IHJhcGlkTWl4Q29uc3RhbnRzLnJhcGlkTWl4RG9jVmVyc2lvbixcbiAgICAgIHRhcmdldDoge1xuICAgICAgICBuYW1lOiBgeG1tOiR7dGhpcy5fbW9kZWxUeXBlfWAsXG4gICAgICAgIHZlcnNpb246ICcxLjAuMCdcbiAgICAgIH0sXG4gICAgICBwYXlsb2FkOiB0aGlzLl9jb25maWcsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVc2UgdGhlIGdpdmVuIFJhcGlkTWl4IG1vZGVsIG9iamVjdCBmb3IgdGhlIGRlY29kaW5nLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gbW9kZWwgLSBSYXBpZE1peCBNb2RlbCBvYmplY3QuXG4gICAqL1xuICBzZXRNb2RlbChtb2RlbCkge1xuICAgIGlmICghbW9kZWwpIHtcbiAgICAgIHRoaXMubW9kZWwgPSBudWxsO1xuICAgICAgdGhpcy5fZGVjb2Rlci5zZXRNb2RlbChudWxsKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0YXJnZXRzID0gbW9kZWwudGFyZ2V0Lm5hbWUuc3BsaXQoJzonKTtcblxuICAgIGlmICh0YXJnZXRzWzBdID09PSAneG1tJylcbiAgICAgIHRoaXMuX21vZGVsVHlwZSA9IHRhcmdldHNbMV0gPT09ICdoaG1tJyA/IHRhcmdldHNbMV0gOiAnZ21tJztcblxuICAgIHRoaXMuX3VwZGF0ZURlY29kZXIoKTtcblxuICAgIHRoaXMuX21vZGVsID0gbW9kZWw7XG4gICAgdGhpcy5fZGVjb2Rlci5zZXRNb2RlbChtb2RlbC5wYXlsb2FkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgbW9kZWwgaW4gUmFwaWRNaXggbW9kZWwgZm9ybWF0LlxuICAgKlxuICAgKiBAcmV0dXJuIHtPYmplY3R9IC0gQ3VycmVudCBSYXBpZE1peCBNb2RlbCBvYmplY3QuXG4gICAqL1xuICBnZXRNb2RlbCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbW9kZWw7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgWG1tUHJvY2Vzc29yO1xuIl19