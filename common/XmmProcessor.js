'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _isInteger=require('babel-runtime/core-js/number/is-integer');var _isInteger2=_interopRequireDefault(_isInteger);var _keys=require('babel-runtime/core-js/object/keys');var _keys2=_interopRequireDefault(_keys);var _getIterator2=require('babel-runtime/core-js/get-iterator');var _getIterator3=_interopRequireDefault(_getIterator2);var _from=require('babel-runtime/core-js/array/from');var _from2=_interopRequireDefault(_from);var _stringify=require('babel-runtime/core-js/json/stringify');var _stringify2=_interopRequireDefault(_stringify);var _promise=require('babel-runtime/core-js/promise');var _promise2=_interopRequireDefault(_promise);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _xmlhttprequest=require('xmlhttprequest');var _xmmClient=require('xmm-client');var Xmm=_interopRequireWildcard(_xmmClient);var _rapidMixAdapters=require('rapid-mix-adapters');function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}// import { translators as rapidMixTranslators } from 'rapid-mix-adapters';
var isNode=new Function("try {return this===global;}catch(e){return false;}");var knownTargets={xmm:['gmm','gmr','hhmm','hhmr']};var defaultXmmConfig={modelType:'gmm',gaussians:1,absoluteRegularization:0.01,relativeRegularization:0.01,covarianceMode:'full',hierarchical:true,states:1,transitionMode:'leftright',regressionEstimator:'full',likelihoodWindow:10};/**
 * Representation of a gesture model. A instance of `XmmProcessor` can
 * train a model from examples and can perform classification and/or
 * regression depending on the chosen algorithm.
 *
 * The training is currently based on the presence of a remote server-side
 * API, that must be able to process rapidMix compliant JSON formats.
 *
 * @param {Object} options - Override default parameters
 * @param {String} [options.url='https://como.ircam.fr/api/v1/train'] - Url
 *  of the training end point.
 */var XmmProcessor=function(){function XmmProcessor(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$url=_ref.url,url=_ref$url===undefined?'https://como.ircam.fr/api/v1/train':_ref$url;(0,_classCallCheck3.default)(this,XmmProcessor);this.url=url;this._config={};this._decoder=null;this._model=null;this._modelType=null;this._likelihoodWindow=null;this.setConfig(defaultXmmConfig);this._updateDecoder();}(0,_createClass3.default)(XmmProcessor,[{key:'_updateDecoder',value:function _updateDecoder(){switch(this._modelType){case'hhmm':this._decoder=new Xmm.HhmmDecoder(this._likelihoodWindow);break;case'gmm':default:this._decoder=new Xmm.GmmDecoder(this._likelihoodWindow);break;}}/**
   * Train the model according to the given `TrainingSet`. In this implmentation
   * the training is performed server-side and rely on an XHR call.
   *
   * @param {JSON} trainingSet - RapidMix compliant JSON formatted training set
   * @return {Promise} - Promise that resolves on the API response (RapidMix API
   *  response format), when the model is updated.
   */},{key:'train',value:function train(trainingSet){var _this=this;// REST request / response - RapidMix
return new _promise2.default(function(resolve,reject){var trainingData={docType:'rapid-mix:ml:http-request',docVersion:_rapidMixAdapters.constants.rapidMixDocVersion,configuration:_this.getConfig(),trainingSet:trainingSet};var xhr=isNode()?new _xmlhttprequest.XMLHttpRequest():new XMLHttpRequest();xhr.open('post',_this.url,true);xhr.responseType='json';xhr.setRequestHeader('Access-Control-Allow-Origin','*');xhr.setRequestHeader('Content-Type','application/json');var errorMsg='an error occured while training the model. ';if(isNode()){// XMLHttpRequest module only supports xhr v1
xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){var body=JSON.parse(xhr.responseText);_this._decoder.setModel(body.model.payload);_this._model=body.model;resolve(body);}else{throw new Error(errorMsg+('response : '+xhr.status+' - '+xhr.responseText));}}};}else{// use xhr v2
xhr.onload=function(){if(xhr.status===200){var body=xhr.response;_this._decoder.setModel(body.model.payload);_this._model=body.model;resolve(body);}else{throw new Error(errorMsg+('response : '+xhr.status+' - '+xhr.response));}};xhr.onerror=function(){throw new Error(errorMsg+('response : '+xhr.status+' - '+xhr.response));};}xhr.send((0,_stringify2.default)(trainingData));});}/**
   * Perform the calssification or the regression of the given vector.
   *
   * @param {Float32Array|Array} vector - Input vector for the decoding.
   * @return {Object} results - Object containing the decoding results.
   */},{key:'run',value:function run(vector){if(vector instanceof Float32Array||vector instanceof Float64Array){vector=(0,_from2.default)(vector);}return this._decoder.filter(vector);}/**
   * Reset the inner model's decoding state.
   */},{key:'reset',value:function reset(){if(this._decoder.reset){this._decoder.reset();}}/**
   * Set the model configuration parameters (or a subset of them).
   *
   * @param {Object} config - RapidMix configuration object (or payload), or subset of parameters.
   */},{key:'setConfig',value:function setConfig(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!config)return;// replace later by isValidRapidMixConfiguration (modelType shouldn't be allowed in payload)
if(config.docType==='rapid-mix:ml:configuration'&&config.docVersion&&config.payload&&config.target&&config.target.name&&config.target.name.split(':')[0]==='xmm'){var target=config.target.name.split(':');config=config.payload;if(target.length>1&&knownTargets.xmm.indexOf(target[1])>-1){if(this._modelType!==target[1]){this._modelType=target[1];this._updateDecoder();}}}if(config.modelType&&knownTargets['xmm'].indexOf(config.modelType)>-1){var val=config.modelType;var newModel=val==='gmr'?'gmm':val==='hhmr'?'hhmm':val;if(newModel!==this._modelType){this._modelType=newModel;this._updateDecoder();}}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=(0,_getIterator3.default)((0,_keys2.default)(config)),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;var _val=config[key];if(key==='gaussians'&&(0,_isInteger2.default)(_val)&&_val>0||key==='absoluteRegularization'&&typeof _val==='number'&&_val>0||key==='relativeRegularization'&&typeof _val==='number'&&_val>0||key==='covarianceMode'&&typeof _val==='string'&&['full','diagonal'].indexOf(_val)>-1||key==='hierarchical'&&typeof _val==='boolean'||key==='states'&&(0,_isInteger2.default)(_val)&&_val>0||key==='transitionMode'&&typeof _val==='string'&&['leftright','ergodic'].indexOf(_val)>-1||key==='regressionEstimator'&&typeof _val==='string'&&['full','windowed','likeliest'].indexOf(_val)>-1){this._config[key]=_val;}else if(key==='likelihoodWindow'&&(0,_isInteger2.default)(_val)&&_val>0){this._likelihoodWindow=_val;if(this._decoder!==null){this._decoder.setLikelihoodWindow(this._likelihoodWindow);}}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}}/**
   * RapidMix compliant configuration object.
   *
   * @return {Object} - RapidMix Configuration object.
   */},{key:'getConfig',value:function getConfig(){return{docType:'rapid-mix:ml:configuration',docVersion:_rapidMixAdapters.constants.rapidMixDocVersion,target:{name:'xmm:'+this._modelType,version:'1.0.0'},payload:this._config};}/**
   * Use the given RapidMix model object for the decoding.
   *
   * @param {Object} model - RapidMix Model object.
   */},{key:'setModel',value:function setModel(model){if(!model){this.model=null;this._decoder.setModel(null);return;}var targets=model.target.name.split(':');if(targets[0]==='xmm')this._modelType=targets[1]==='hhmm'?targets[1]:'gmm';this._updateDecoder();this._model=model;this._decoder.setModel(model.payload);}/**
   * Retrieve the model in RapidMix model format.
   *
   * @return {Object} - Current RapidMix Model object.
   */},{key:'getModel',value:function getModel(){return this._model;}}]);return XmmProcessor;}();exports.default=XmmProcessor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlhtbSIsImlzTm9kZSIsIkZ1bmN0aW9uIiwia25vd25UYXJnZXRzIiwieG1tIiwiZGVmYXVsdFhtbUNvbmZpZyIsIm1vZGVsVHlwZSIsImdhdXNzaWFucyIsImFic29sdXRlUmVndWxhcml6YXRpb24iLCJyZWxhdGl2ZVJlZ3VsYXJpemF0aW9uIiwiY292YXJpYW5jZU1vZGUiLCJoaWVyYXJjaGljYWwiLCJzdGF0ZXMiLCJ0cmFuc2l0aW9uTW9kZSIsInJlZ3Jlc3Npb25Fc3RpbWF0b3IiLCJsaWtlbGlob29kV2luZG93IiwiWG1tUHJvY2Vzc29yIiwidXJsIiwiX2NvbmZpZyIsIl9kZWNvZGVyIiwiX21vZGVsIiwiX21vZGVsVHlwZSIsIl9saWtlbGlob29kV2luZG93Iiwic2V0Q29uZmlnIiwiX3VwZGF0ZURlY29kZXIiLCJIaG1tRGVjb2RlciIsIkdtbURlY29kZXIiLCJ0cmFpbmluZ1NldCIsInJlc29sdmUiLCJyZWplY3QiLCJ0cmFpbmluZ0RhdGEiLCJkb2NUeXBlIiwiZG9jVmVyc2lvbiIsInJhcGlkTWl4RG9jVmVyc2lvbiIsImNvbmZpZ3VyYXRpb24iLCJnZXRDb25maWciLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJyZXNwb25zZVR5cGUiLCJzZXRSZXF1ZXN0SGVhZGVyIiwiZXJyb3JNc2ciLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwiYm9keSIsIkpTT04iLCJwYXJzZSIsInJlc3BvbnNlVGV4dCIsInNldE1vZGVsIiwibW9kZWwiLCJwYXlsb2FkIiwiRXJyb3IiLCJvbmxvYWQiLCJyZXNwb25zZSIsIm9uZXJyb3IiLCJzZW5kIiwidmVjdG9yIiwiRmxvYXQzMkFycmF5IiwiRmxvYXQ2NEFycmF5IiwiZmlsdGVyIiwicmVzZXQiLCJjb25maWciLCJ0YXJnZXQiLCJuYW1lIiwic3BsaXQiLCJsZW5ndGgiLCJpbmRleE9mIiwidmFsIiwibmV3TW9kZWwiLCJr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LENBQ0YsQ0FsRG9CLCtMQW1EdEIsQ0FFRDs7OztrREFLWSxDQUNWLE1BQU8sQ0FDTFMsUUFBUyw0QkFESixDQUVMQyxXQUFZLDRCQUFrQkMsa0JBRnpCLENBR0w4QixPQUFRLENBQ05DLFlBQWEsS0FBSzNDLFVBRFosQ0FFTm1ELFFBQVMsT0FGSCxDQUhILENBT0xyQixRQUFTLEtBQUtqQyxPQVBULENBQVAsQ0FTRCxDQUVEOzs7OytDQUtTZ0MsSyxDQUFPLENBQ2QsR0FBSSxDQUFDQSxLQUFMLENBQVksQ0FDVixLQUFLQSxLQUFMLENBQWEsSUFBYixDQUNBLEtBQUsvQixRQUFMLENBQWM4QixRQUFkLENBQXVCLElBQXZCLEVBQ0EsT0FDRCxDQUVELEdBQU13QixTQUFVdkIsTUFBTWEsTUFBTixDQUFhQyxJQUFiLENBQWtCQyxLQUFsQixDQUF3QixHQUF4QixDQUFoQixDQUVBLEdBQUlRLFFBQVEsQ0FBUixJQUFlLEtBQW5CLENBQ0UsS0FBS3BELFVBQUwsQ0FBa0JvRCxRQUFRLENBQVIsSUFBZSxNQUFmLENBQXdCQSxRQUFRLENBQVIsQ0FBeEIsQ0FBcUMsS0FBdkQsQ0FFRixLQUFLakQsY0FBTCxHQUVBLEtBQUtKLE1BQUwsQ0FBYzhCLEtBQWQsQ0FDQSxLQUFLL0IsUUFBTCxDQUFjOEIsUUFBZCxDQUF1QkMsTUFBTUMsT0FBN0IsRUFDRCxDQUVEOzs7O2dEQUtXLENBQ1QsTUFBTyxNQUFLL0IsTUFBWixDQUNELEMsNENBR1lKLFkiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBYTUxIdHRwUmVxdWVzdCBhcyBYSFIgfSBmcm9tICd4bWxodHRwcmVxdWVzdCc7XG5pbXBvcnQgKiBhcyBYbW0gZnJvbSAneG1tLWNsaWVudCc7XG5pbXBvcnQgeyBjb25zdGFudHMgYXMgcmFwaWRNaXhDb25zdGFudHMgfSBmcm9tICdyYXBpZC1taXgtYWRhcHRlcnMnO1xuLy8gaW1wb3J0IHsgdHJhbnNsYXRvcnMgYXMgcmFwaWRNaXhUcmFuc2xhdG9ycyB9IGZyb20gJ3JhcGlkLW1peC1hZGFwdGVycyc7XG5cbmNvbnN0IGlzTm9kZSA9IG5ldyBGdW5jdGlvbihcInRyeSB7cmV0dXJuIHRoaXM9PT1nbG9iYWw7fWNhdGNoKGUpe3JldHVybiBmYWxzZTt9XCIpO1xuXG5jb25zdCBrbm93blRhcmdldHMgPSB7XG4gIHhtbTogWyAnZ21tJywgJ2dtcicsICdoaG1tJywgJ2hobXInIF1cbn07XG5cbmNvbnN0IGRlZmF1bHRYbW1Db25maWcgPSB7XG4gIG1vZGVsVHlwZTogJ2dtbScsXG4gIGdhdXNzaWFuczogMSxcbiAgYWJzb2x1dGVSZWd1bGFyaXphdGlvbjogMC4wMSxcbiAgcmVsYXRpdmVSZWd1bGFyaXphdGlvbjogMC4wMSxcbiAgY292YXJpYW5jZU1vZGU6ICdmdWxsJyxcbiAgaGllcmFyY2hpY2FsOiB0cnVlLFxuICBzdGF0ZXM6IDEsXG4gIHRyYW5zaXRpb25Nb2RlOiAnbGVmdHJpZ2h0JyxcbiAgcmVncmVzc2lvbkVzdGltYXRvcjogJ2Z1bGwnLFxuICBsaWtlbGlob29kV2luZG93OiAxMCxcbn07XG5cbi8qKlxuICogUmVwcmVzZW50YXRpb24gb2YgYSBnZXN0dXJlIG1vZGVsLiBBIGluc3RhbmNlIG9mIGBYbW1Qcm9jZXNzb3JgIGNhblxuICogdHJhaW4gYSBtb2RlbCBmcm9tIGV4YW1wbGVzIGFuZCBjYW4gcGVyZm9ybSBjbGFzc2lmaWNhdGlvbiBhbmQvb3JcbiAqIHJlZ3Jlc3Npb24gZGVwZW5kaW5nIG9uIHRoZSBjaG9zZW4gYWxnb3JpdGhtLlxuICpcbiAqIFRoZSB0cmFpbmluZyBpcyBjdXJyZW50bHkgYmFzZWQgb24gdGhlIHByZXNlbmNlIG9mIGEgcmVtb3RlIHNlcnZlci1zaWRlXG4gKiBBUEksIHRoYXQgbXVzdCBiZSBhYmxlIHRvIHByb2Nlc3MgcmFwaWRNaXggY29tcGxpYW50IEpTT04gZm9ybWF0cy5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIE92ZXJyaWRlIGRlZmF1bHQgcGFyYW1ldGVyc1xuICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLnVybD0naHR0cHM6Ly9jb21vLmlyY2FtLmZyL2FwaS92MS90cmFpbiddIC0gVXJsXG4gKiAgb2YgdGhlIHRyYWluaW5nIGVuZCBwb2ludC5cbiAqL1xuY2xhc3MgWG1tUHJvY2Vzc29yIHtcbiAgY29uc3RydWN0b3Ioe1xuICAgIHVybCA9ICdodHRwczovL2NvbW8uaXJjYW0uZnIvYXBpL3YxL3RyYWluJyxcbiAgfSA9IHt9KSB7XG4gICAgdGhpcy51cmwgPSB1cmw7XG5cbiAgICB0aGlzLl9jb25maWcgPSB7fTtcbiAgICB0aGlzLl9kZWNvZGVyID0gbnVsbDtcbiAgICB0aGlzLl9tb2RlbCA9IG51bGw7XG4gICAgdGhpcy5fbW9kZWxUeXBlID0gbnVsbDtcbiAgICB0aGlzLl9saWtlbGlob29kV2luZG93ID0gbnVsbDtcblxuICAgIHRoaXMuc2V0Q29uZmlnKGRlZmF1bHRYbW1Db25maWcpO1xuICAgIHRoaXMuX3VwZGF0ZURlY29kZXIoKTtcbiAgfVxuXG4gIF91cGRhdGVEZWNvZGVyKCkge1xuICAgIHN3aXRjaCAodGhpcy5fbW9kZWxUeXBlKSB7XG4gICAgICBjYXNlICdoaG1tJzpcbiAgICAgICAgdGhpcy5fZGVjb2RlciA9IG5ldyBYbW0uSGhtbURlY29kZXIodGhpcy5fbGlrZWxpaG9vZFdpbmRvdyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZ21tJzpcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRoaXMuX2RlY29kZXIgPSBuZXcgWG1tLkdtbURlY29kZXIodGhpcy5fbGlrZWxpaG9vZFdpbmRvdyk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFpbiB0aGUgbW9kZWwgYWNjb3JkaW5nIHRvIHRoZSBnaXZlbiBgVHJhaW5pbmdTZXRgLiBJbiB0aGlzIGltcGxtZW50YXRpb25cbiAgICogdGhlIHRyYWluaW5nIGlzIHBlcmZvcm1lZCBzZXJ2ZXItc2lkZSBhbmQgcmVseSBvbiBhbiBYSFIgY2FsbC5cbiAgICpcbiAgICogQHBhcmFtIHtKU09OfSB0cmFpbmluZ1NldCAtIFJhcGlkTWl4IGNvbXBsaWFudCBKU09OIGZvcm1hdHRlZCB0cmFpbmluZyBzZXRcbiAgICogQHJldHVybiB7UHJvbWlzZX0gLSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgb24gdGhlIEFQSSByZXNwb25zZSAoUmFwaWRNaXggQVBJXG4gICAqICByZXNwb25zZSBmb3JtYXQpLCB3aGVuIHRoZSBtb2RlbCBpcyB1cGRhdGVkLlxuICAgKi9cbiAgdHJhaW4odHJhaW5pbmdTZXQpIHtcbiAgICAvLyBSRVNUIHJlcXVlc3QgLyByZXNwb25zZSAtIFJhcGlkTWl4XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHRyYWluaW5nRGF0YSA9IHtcbiAgICAgICAgZG9jVHlwZTogJ3JhcGlkLW1peDptbDpodHRwLXJlcXVlc3QnLFxuICAgICAgICBkb2NWZXJzaW9uOiByYXBpZE1peENvbnN0YW50cy5yYXBpZE1peERvY1ZlcnNpb24sXG4gICAgICAgIGNvbmZpZ3VyYXRpb246IHRoaXMuZ2V0Q29uZmlnKCksXG4gICAgICAgIHRyYWluaW5nU2V0OiB0cmFpbmluZ1NldFxuICAgICAgfTtcblxuICAgICAgY29uc3QgeGhyID0gaXNOb2RlKCkgPyBuZXcgWEhSKCkgOiBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgICAgeGhyLm9wZW4oJ3Bvc3QnLCB0aGlzLnVybCwgdHJ1ZSk7XG4gICAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2pzb24nO1xuICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJyk7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblxuICAgICAgY29uc3QgZXJyb3JNc2cgPSAnYW4gZXJyb3Igb2NjdXJlZCB3aGlsZSB0cmFpbmluZyB0aGUgbW9kZWwuICc7XG5cbiAgICAgIGlmIChpc05vZGUoKSkgeyAvLyBYTUxIdHRwUmVxdWVzdCBtb2R1bGUgb25seSBzdXBwb3J0cyB4aHIgdjFcbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9ICgpID0+IHtcbiAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgIHRoaXMuX2RlY29kZXIuc2V0TW9kZWwoYm9keS5tb2RlbC5wYXlsb2FkKTtcbiAgICAgICAgICAgICAgdGhpcy5fbW9kZWwgPSBib2R5Lm1vZGVsO1xuICAgICAgICAgICAgICByZXNvbHZlKGJvZHkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTXNnICsgYHJlc3BvbnNlIDogJHt4aHIuc3RhdHVzfSAtICR7eGhyLnJlc3BvbnNlVGV4dH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7IC8vIHVzZSB4aHIgdjJcbiAgICAgICAgeGhyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICBjb25zdCBib2R5ID0geGhyLnJlc3BvbnNlO1xuICAgICAgICAgICAgdGhpcy5fZGVjb2Rlci5zZXRNb2RlbChib2R5Lm1vZGVsLnBheWxvYWQpO1xuICAgICAgICAgICAgdGhpcy5fbW9kZWwgPSBib2R5Lm1vZGVsO1xuICAgICAgICAgICAgcmVzb2x2ZShib2R5KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTXNnICsgYHJlc3BvbnNlIDogJHt4aHIuc3RhdHVzfSAtICR7eGhyLnJlc3BvbnNlfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB4aHIub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNc2cgKyBgcmVzcG9uc2UgOiAke3hoci5zdGF0dXN9IC0gJHt4aHIucmVzcG9uc2V9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkodHJhaW5pbmdEYXRhKSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUGVyZm9ybSB0aGUgY2Fsc3NpZmljYXRpb24gb3IgdGhlIHJlZ3Jlc3Npb24gb2YgdGhlIGdpdmVuIHZlY3Rvci5cbiAgICpcbiAgICogQHBhcmFtIHtGbG9hdDMyQXJyYXl8QXJyYXl9IHZlY3RvciAtIElucHV0IHZlY3RvciBmb3IgdGhlIGRlY29kaW5nLlxuICAgKiBAcmV0dXJuIHtPYmplY3R9IHJlc3VsdHMgLSBPYmplY3QgY29udGFpbmluZyB0aGUgZGVjb2RpbmcgcmVzdWx0cy5cbiAgICovXG4gIHJ1bih2ZWN0b3IpIHtcbiAgICBpZiAodmVjdG9yIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5IHx8IHZlY3RvciBpbnN0YW5jZW9mIEZsb2F0NjRBcnJheSkge1xuICAgICAgdmVjdG9yID0gQXJyYXkuZnJvbSh2ZWN0b3IpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9kZWNvZGVyLmZpbHRlcih2ZWN0b3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IHRoZSBpbm5lciBtb2RlbCdzIGRlY29kaW5nIHN0YXRlLlxuICAgKi9cbiAgcmVzZXQoKSB7XG4gICAgaWYgKHRoaXMuX2RlY29kZXIucmVzZXQpIHtcbiAgICAgIHRoaXMuX2RlY29kZXIucmVzZXQoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBtb2RlbCBjb25maWd1cmF0aW9uIHBhcmFtZXRlcnMgKG9yIGEgc3Vic2V0IG9mIHRoZW0pLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIC0gUmFwaWRNaXggY29uZmlndXJhdGlvbiBvYmplY3QgKG9yIHBheWxvYWQpLCBvciBzdWJzZXQgb2YgcGFyYW1ldGVycy5cbiAgICovXG4gIHNldENvbmZpZyhjb25maWcgPSB7fSkge1xuICAgIGlmICghY29uZmlnKVxuICAgICAgcmV0dXJuO1xuXG4gICAgLy8gcmVwbGFjZSBsYXRlciBieSBpc1ZhbGlkUmFwaWRNaXhDb25maWd1cmF0aW9uIChtb2RlbFR5cGUgc2hvdWxkbid0IGJlIGFsbG93ZWQgaW4gcGF5bG9hZClcbiAgICBpZiAoY29uZmlnLmRvY1R5cGUgPT09ICdyYXBpZC1taXg6bWw6Y29uZmlndXJhdGlvbicgJiYgY29uZmlnLmRvY1ZlcnNpb24gJiYgY29uZmlnLnBheWxvYWQgJiZcbiAgICAgICAgY29uZmlnLnRhcmdldCAmJiBjb25maWcudGFyZ2V0Lm5hbWUgJiYgY29uZmlnLnRhcmdldC5uYW1lLnNwbGl0KCc6JylbMF0gPT09ICd4bW0nKSB7XG5cbiAgICAgIGNvbnN0IHRhcmdldCA9IGNvbmZpZy50YXJnZXQubmFtZS5zcGxpdCgnOicpO1xuICAgICAgY29uZmlnID0gY29uZmlnLnBheWxvYWQ7XG4gICAgICBpZiAodGFyZ2V0Lmxlbmd0aCA+IDEgJiYga25vd25UYXJnZXRzLnhtbS5pbmRleE9mKHRhcmdldFsxXSkgPiAtMSkge1xuICAgICAgICBpZiAodGhpcy5fbW9kZWxUeXBlICE9PSB0YXJnZXRbMV0pIHtcbiAgICAgICAgICB0aGlzLl9tb2RlbFR5cGUgPSB0YXJnZXRbMV07XG4gICAgICAgICAgdGhpcy5fdXBkYXRlRGVjb2RlcigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5tb2RlbFR5cGUgJiYga25vd25UYXJnZXRzWyd4bW0nXS5pbmRleE9mKGNvbmZpZy5tb2RlbFR5cGUpID4gLTEpIHtcbiAgICAgIGNvbnN0IHZhbCA9IGNvbmZpZy5tb2RlbFR5cGU7XG4gICAgICBjb25zdCBuZXdNb2RlbCA9ICh2YWwgPT09ICdnbXInKSA/ICdnbW0nIDogKCh2YWwgPT09ICdoaG1yJykgPyAnaGhtbScgOiB2YWwpO1xuXG4gICAgICBpZiAobmV3TW9kZWwgIT09IHRoaXMuX21vZGVsVHlwZSkge1xuICAgICAgICB0aGlzLl9tb2RlbFR5cGUgPSBuZXdNb2RlbDtcbiAgICAgICAgdGhpcy5fdXBkYXRlRGVjb2RlcigpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAobGV0IGtleSBvZiBPYmplY3Qua2V5cyhjb25maWcpKSB7XG4gICAgICBjb25zdCB2YWwgPSBjb25maWdba2V5XTtcblxuICAgICAgaWYgKChrZXkgPT09ICdnYXVzc2lhbnMnICYmIE51bWJlci5pc0ludGVnZXIodmFsKSAmJiB2YWwgPiAwKSB8fFxuICAgICAgICAgIChrZXkgPT09ICdhYnNvbHV0ZVJlZ3VsYXJpemF0aW9uJyAmJiB0eXBlb2YgdmFsID09PSAnbnVtYmVyJyAmJiB2YWwgPiAwKSB8fFxuICAgICAgICAgIChrZXkgPT09ICdyZWxhdGl2ZVJlZ3VsYXJpemF0aW9uJyAmJiB0eXBlb2YgdmFsID09PSAnbnVtYmVyJyAmJiB2YWwgPiAwKSB8fFxuICAgICAgICAgIChrZXkgPT09ICdjb3ZhcmlhbmNlTW9kZScgJiYgdHlwZW9mIHZhbCA9PT0gJ3N0cmluZycgJiZcbiAgICAgICAgICAgIFsnZnVsbCcsICdkaWFnb25hbCddLmluZGV4T2YodmFsKSA+IC0xKSB8fFxuICAgICAgICAgIChrZXkgPT09ICdoaWVyYXJjaGljYWwnICYmIHR5cGVvZiB2YWwgPT09ICdib29sZWFuJykgfHxcbiAgICAgICAgICAoa2V5ID09PSAnc3RhdGVzJyAmJiBOdW1iZXIuaXNJbnRlZ2VyKHZhbCkgJiYgdmFsID4gMCkgfHxcbiAgICAgICAgICAoa2V5ID09PSAndHJhbnNpdGlvbk1vZGUnICYmIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICBbJ2xlZnRyaWdodCcsICdlcmdvZGljJ10uaW5kZXhPZih2YWwpID4gLTEpIHx8XG4gICAgICAgICAgKGtleSA9PT0gJ3JlZ3Jlc3Npb25Fc3RpbWF0b3InICYmIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICBbJ2Z1bGwnLCAnd2luZG93ZWQnLCAnbGlrZWxpZXN0J10uaW5kZXhPZih2YWwpID4gLTEpKSB7XG4gICAgICAgIHRoaXMuX2NvbmZpZ1trZXldID0gdmFsO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdsaWtlbGlob29kV2luZG93JyAmJiBOdW1iZXIuaXNJbnRlZ2VyKHZhbCkgJiYgdmFsID4gMCkge1xuICAgICAgICB0aGlzLl9saWtlbGlob29kV2luZG93ID0gdmFsO1xuXG4gICAgICAgIGlmICh0aGlzLl9kZWNvZGVyICE9PSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5fZGVjb2Rlci5zZXRMaWtlbGlob29kV2luZG93KHRoaXMuX2xpa2VsaWhvb2RXaW5kb3cpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJhcGlkTWl4IGNvbXBsaWFudCBjb25maWd1cmF0aW9uIG9iamVjdC5cbiAgICpcbiAgICogQHJldHVybiB7T2JqZWN0fSAtIFJhcGlkTWl4IENvbmZpZ3VyYXRpb24gb2JqZWN0LlxuICAgKi9cbiAgZ2V0Q29uZmlnKCkge1xuICAgIHJldHVybiB7XG4gICAgICBkb2NUeXBlOiAncmFwaWQtbWl4Om1sOmNvbmZpZ3VyYXRpb24nLFxuICAgICAgZG9jVmVyc2lvbjogcmFwaWRNaXhDb25zdGFudHMucmFwaWRNaXhEb2NWZXJzaW9uLFxuICAgICAgdGFyZ2V0OiB7XG4gICAgICAgIG5hbWU6IGB4bW06JHt0aGlzLl9tb2RlbFR5cGV9YCxcbiAgICAgICAgdmVyc2lvbjogJzEuMC4wJ1xuICAgICAgfSxcbiAgICAgIHBheWxvYWQ6IHRoaXMuX2NvbmZpZyxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZSB0aGUgZ2l2ZW4gUmFwaWRNaXggbW9kZWwgb2JqZWN0IGZvciB0aGUgZGVjb2RpbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtb2RlbCAtIFJhcGlkTWl4IE1vZGVsIG9iamVjdC5cbiAgICovXG4gIHNldE1vZGVsKG1vZGVsKSB7XG4gICAgaWYgKCFtb2RlbCkge1xuICAgICAgdGhpcy5tb2RlbCA9IG51bGw7XG4gICAgICB0aGlzLl9kZWNvZGVyLnNldE1vZGVsKG51bGwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHRhcmdldHMgPSBtb2RlbC50YXJnZXQubmFtZS5zcGxpdCgnOicpO1xuXG4gICAgaWYgKHRhcmdldHNbMF0gPT09ICd4bW0nKVxuICAgICAgdGhpcy5fbW9kZWxUeXBlID0gdGFyZ2V0c1sxXSA9PT0gJ2hobW0nID8gdGFyZ2V0c1sxXSA6ICdnbW0nO1xuXG4gICAgdGhpcy5fdXBkYXRlRGVjb2RlcigpO1xuXG4gICAgdGhpcy5fbW9kZWwgPSBtb2RlbDtcbiAgICB0aGlzLl9kZWNvZGVyLnNldE1vZGVsKG1vZGVsLnBheWxvYWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBtb2RlbCBpbiBSYXBpZE1peCBtb2RlbCBmb3JtYXQuXG4gICAqXG4gICAqIEByZXR1cm4ge09iamVjdH0gLSBDdXJyZW50IFJhcGlkTWl4IE1vZGVsIG9iamVjdC5cbiAgICovXG4gIGdldE1vZGVsKCkge1xuICAgIHJldHVybiB0aGlzLl9tb2RlbDtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBYbW1Qcm9jZXNzb3I7XG4iXX0=