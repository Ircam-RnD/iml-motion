'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _set=require('babel-runtime/core-js/set');var _set2=_interopRequireDefault(_set);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _client=require('waves-lfo/client');var lfo=_interopRequireWildcard(_client);var _lfoMotion=require('lfo-motion');var lfoMotion=_interopRequireWildcard(_lfoMotion);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
 * High-level abstraction that listen for raw sensors (accelerometers and
 * gyroscopes) and apply a set of preprocessing / filtering on it.
 *
 * The output is composed of 8 values:
 * - IntensityNorm
 * - IntensityNormBoost
 * - BandPass AccX
 * - BandPass AccY
 * - BandPass AccZ
 * - Orientation X (processed from acc and gyro)
 * - Orientation Y (processed from acc and gyro)
 * - Orientation Z (processed from acc and gyro)
 *
 * @example
 * import { ProcessedSensors } from 'iml-motion';
 *
 * const processedSensors = new ProcessedSensors();
 * processedSensors.addListener(data => console.log(data));
 * processedSensors
 *  .init()
 *  .then(() => processedSensors.start());
 */var ProcessedSensors=function(){function ProcessedSensors(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$frameRate=_ref.frameRate,frameRate=_ref$frameRate===undefined?1/0.02:_ref$frameRate;(0,_classCallCheck3.default)(this,ProcessedSensors);this.frameRate=frameRate;this._emit=this._emit.bind(this);// create the lfo graph
this.motionInput=new lfoMotion.source.MotionInput();this.sampler=new lfoMotion.operator.Sampler({frameRate:frameRate});this.accSelect=new lfo.operator.Select({indexes:[0,1,2]});// intensity
this.intensity=new lfoMotion.operator.Intensity({feedback:0.7,gain:0.07});this.intensityNormSelect=new lfo.operator.Select({index:0});// boost
this.intensityClip=new lfo.operator.Clip({min:0,max:1});this.intensityPower=new lfo.operator.Power({exponent:0.25});this.powerClip=new lfo.operator.Clip({min:0.15,max:1});this.powerScale=new lfo.operator.Scale({inputMin:0.15,inputMax:1,outputMin:0,outputMax:1});// bandpass
this.normalizeAcc=new lfo.operator.Multiplier({factor:1/9.81});this.bandpass=new lfo.operator.Biquad({type:'bandpass',q:1,f0:5});this.bandpassGain=new lfo.operator.Multiplier({factor:1});// orientation filter
this.orientation=new lfoMotion.operator.Orientation();// merge and output
this.merger=new lfo.operator.Merger({frameSizes:[1,1,3,3]});this.bridge=new lfo.sink.Bridge({processFrame:this._emit,finalizeStream:this._emit});this.motionInput.connect(this.sampler);// for intensity and bandpass
this.sampler.connect(this.accSelect);// intensity branch
this.accSelect.connect(this.intensity);this.intensity.connect(this.intensityNormSelect);this.intensityNormSelect.connect(this.merger);// boost branch
this.intensityNormSelect.connect(this.intensityClip);this.intensityClip.connect(this.intensityPower);this.intensityPower.connect(this.powerClip);this.powerClip.connect(this.powerScale);this.powerScale.connect(this.merger);// biquad branch
this.accSelect.connect(this.normalizeAcc);this.normalizeAcc.connect(this.bandpass);this.bandpass.connect(this.bandpassGain);this.bandpassGain.connect(this.merger);// orientation
this.sampler.connect(this.orientation);this.orientation.connect(this.merger);this.merger.connect(this.bridge);this._listeners=new _set2.default();}(0,_createClass3.default)(ProcessedSensors,[{key:'init',value:function init(){var promise=this.motionInput.init();// promise.then(() => {
this.frameRate=this.motionInput.streamParams.frameRate;// })
// .catch(err => console.error(err.stack));
return promise;}/**
   * Start listening to the sensors
   */},{key:'start',value:function start(){this.motionInput.start();}/**
   * Stop listening to the sensors
   */},{key:'stop',value:function stop(){this.motionInput.stop();}/**
   * Add a listener to the module.
   *
   * @param {ProcessedSensorsListener} callback - Listener to register, the
   *  callback is executed with an array containing the processed data from
   *  the sensors
   */},{key:'addListener',value:function addListener(callback){this._listeners.add(callback);}/**
   * Remove a listener from the module.
   *
   * @param {ProcessedSensorsListener} callback - Listener to delete
   */},{key:'removeListener',value:function removeListener(callback){this._listeners.delete(callback);}/** @private */},{key:'_emit',value:function _emit(frame){this._listeners.forEach(function(listener){return listener(frame.data);});}}]);return ProcessedSensors;}();exports.default=ProcessedSensors;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRvcnMuanMiXSwibmFtZXMiOlsibGZvIiwibGZvTW90aW9uIiwiUHJvY2Vzc2VkU2Vuc29ycyIsImZyYW1lUmF0ZSIsIl9lbWl0IiwiYmluZCIsIm1vdGlvbklucHV0Iiwic291cmNlIiwiTW90aW9uSW5wdXQiLCJzYW1wbGVyIiwib3BlcmF0b3IiLCJTYW1wbGVyIiwiYWNjU2VsZWN0IiwiU2VsZWN0IiwiaW5kZXhlcyIsImludGVuc2l0eSIsIkludGVuc2l0eSIsImZlZWRiYWNrIiwiZ2FpbiIsImludGVuc2l0eU5vcm1TZWxlY3QiLCJpbmRleCIsImludGVuc2l0eUNsaXAiLCJDbGlwIiwibWluIiwibWF4IiwiaW50ZW5zaXR5UG93ZXIiLCJQb3dlciIsImV4cG9uZW50IiwicG93ZXJDbGlwIiwicG93ZXJTY2FsZSIsIlNjYWxlIiwiaW5wdXRNaW4iLCJpbnB1dE1heCIsIm91dHB1dE1pbiIsIm91dHB1dE1heCIsIm5vcm1hbGl6ZUFjYyIsIk11bHRpcGxpZXIiLCJmYWN0b3IiLCJiYW5kcGFzcyIsIkJpcXVhZCIsInR5cGUiLCJxIiwiZjAiLCJiYW5kcGFzc0dhaW4iLCJvcmllbnRhdGlvbiIsIk9yaWVudGF0aW9uIiwibWVyZ2VyIiwiTWVyZ2VyIiwiZnJhbWVTaXplcyIsImJyaWRnZSIsInNpbmsiLCJCcmlkZ2UiLCJwcm9jZXNzRnJhbWUiLCJmaW5hbGl6ZVN0cmVhbSIsImNvbm5lY3QiLCJfbGlzdGVuZXJzIiwicHJvbWlzZSIsImluaXQiLCJzdHJlYW1QYXJhbXMiLCJzdGFydCIsInN0b3AiLCJjYWxsYmFjayIsImFkZCIsImRlbGV0ZSIsImZyYW1lIiwiZm9yRWFjaCIsImxpc3RlbmVyIiwiZGF0YSJdLCJtYXBwaW5ncyI6InFaQUFBLHdDLEdBQVlBLEksa0NBQ1oscUMsR0FBWUMsVSxrV0FFWjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztNQXVCTUMsaUIsWUFDSiwyQkFFUSxvRUFBSixFQUFJLHFCQUROQyxTQUNNLENBRE5BLFNBQ00s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akIsR0FDRCxDQUVEOzt3Q0FHTyxDQUNMLEtBQUtyRCxXQUFMLENBQWlCc0QsSUFBakIsR0FDRCxDQUVEOzs7Ozs7cURBT1lDLFEsQ0FBVSxDQUNwQixLQUFLTixVQUFMLENBQWdCTyxHQUFoQixDQUFvQkQsUUFBcEIsRUFDRCxDQUVEOzs7OzJEQUtlQSxRLENBQVUsQ0FDdkIsS0FBS04sVUFBTCxDQUFnQlEsTUFBaEIsQ0FBdUJGLFFBQXZCLEVBQ0QsQ0FFRCxlLG9DQUNNRyxLLENBQU8sQ0FDWCxLQUFLVCxVQUFMLENBQWdCVSxPQUFoQixDQUF3Qix5QkFBWUMsVUFBU0YsTUFBTUcsSUFBZixDQUFaLEVBQXhCLEVBQ0QsQyxnREFJWWpFLGdCIiwiZmlsZSI6InZhbGlkYXRvcnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBsZm8gZnJvbSAnd2F2ZXMtbGZvL2NsaWVudCc7XG5pbXBvcnQgKiBhcyBsZm9Nb3Rpb24gZnJvbSAnbGZvLW1vdGlvbic7XG5cbi8qKlxuICogSGlnaC1sZXZlbCBhYnN0cmFjdGlvbiB0aGF0IGxpc3RlbiBmb3IgcmF3IHNlbnNvcnMgKGFjY2VsZXJvbWV0ZXJzIGFuZFxuICogZ3lyb3Njb3BlcykgYW5kIGFwcGx5IGEgc2V0IG9mIHByZXByb2Nlc3NpbmcgLyBmaWx0ZXJpbmcgb24gaXQuXG4gKlxuICogVGhlIG91dHB1dCBpcyBjb21wb3NlZCBvZiA4IHZhbHVlczpcbiAqIC0gSW50ZW5zaXR5Tm9ybVxuICogLSBJbnRlbnNpdHlOb3JtQm9vc3RcbiAqIC0gQmFuZFBhc3MgQWNjWFxuICogLSBCYW5kUGFzcyBBY2NZXG4gKiAtIEJhbmRQYXNzIEFjY1pcbiAqIC0gT3JpZW50YXRpb24gWCAocHJvY2Vzc2VkIGZyb20gYWNjIGFuZCBneXJvKVxuICogLSBPcmllbnRhdGlvbiBZIChwcm9jZXNzZWQgZnJvbSBhY2MgYW5kIGd5cm8pXG4gKiAtIE9yaWVudGF0aW9uIFogKHByb2Nlc3NlZCBmcm9tIGFjYyBhbmQgZ3lybylcbiAqXG4gKiBAZXhhbXBsZVxuICogaW1wb3J0IHsgUHJvY2Vzc2VkU2Vuc29ycyB9IGZyb20gJ2ltbC1tb3Rpb24nO1xuICpcbiAqIGNvbnN0IHByb2Nlc3NlZFNlbnNvcnMgPSBuZXcgUHJvY2Vzc2VkU2Vuc29ycygpO1xuICogcHJvY2Vzc2VkU2Vuc29ycy5hZGRMaXN0ZW5lcihkYXRhID0+IGNvbnNvbGUubG9nKGRhdGEpKTtcbiAqIHByb2Nlc3NlZFNlbnNvcnNcbiAqICAuaW5pdCgpXG4gKiAgLnRoZW4oKCkgPT4gcHJvY2Vzc2VkU2Vuc29ycy5zdGFydCgpKTtcbiAqL1xuY2xhc3MgUHJvY2Vzc2VkU2Vuc29ycyB7XG4gIGNvbnN0cnVjdG9yKHtcbiAgICBmcmFtZVJhdGUgPSAxIC8gMC4wMixcbiAgfSA9IHt9KSB7XG4gICAgdGhpcy5mcmFtZVJhdGUgPSBmcmFtZVJhdGU7XG5cbiAgICB0aGlzLl9lbWl0ID0gdGhpcy5fZW1pdC5iaW5kKHRoaXMpO1xuXG4gICAgLy8gY3JlYXRlIHRoZSBsZm8gZ3JhcGhcbiAgICB0aGlzLm1vdGlvbklucHV0ID0gbmV3IGxmb01vdGlvbi5zb3VyY2UuTW90aW9uSW5wdXQoKTtcblxuICAgIHRoaXMuc2FtcGxlciA9IG5ldyBsZm9Nb3Rpb24ub3BlcmF0b3IuU2FtcGxlcih7XG4gICAgICBmcmFtZVJhdGU6IGZyYW1lUmF0ZSxcbiAgICB9KTtcblxuICAgIHRoaXMuYWNjU2VsZWN0ID0gbmV3IGxmby5vcGVyYXRvci5TZWxlY3QoeyBpbmRleGVzOiBbMCwgMSwgMl0gfSk7XG5cbiAgICAvLyBpbnRlbnNpdHlcbiAgICB0aGlzLmludGVuc2l0eSA9IG5ldyBsZm9Nb3Rpb24ub3BlcmF0b3IuSW50ZW5zaXR5KHtcbiAgICAgIGZlZWRiYWNrOiAwLjcsXG4gICAgICBnYWluOiAwLjA3LFxuICAgIH0pO1xuXG4gICAgdGhpcy5pbnRlbnNpdHlOb3JtU2VsZWN0ID0gbmV3IGxmby5vcGVyYXRvci5TZWxlY3QoeyBpbmRleDogMCB9KTtcblxuICAgIC8vIGJvb3N0XG4gICAgdGhpcy5pbnRlbnNpdHlDbGlwID0gbmV3IGxmby5vcGVyYXRvci5DbGlwKHsgbWluOiAwLCBtYXg6IDEgfSk7XG4gICAgdGhpcy5pbnRlbnNpdHlQb3dlciA9IG5ldyBsZm8ub3BlcmF0b3IuUG93ZXIoeyBleHBvbmVudDogMC4yNSB9KTtcbiAgICB0aGlzLnBvd2VyQ2xpcCA9IG5ldyBsZm8ub3BlcmF0b3IuQ2xpcCh7IG1pbjogMC4xNSwgbWF4OiAxIH0pO1xuICAgIHRoaXMucG93ZXJTY2FsZSA9IG5ldyBsZm8ub3BlcmF0b3IuU2NhbGUoe1xuICAgICAgaW5wdXRNaW46IDAuMTUsXG4gICAgICBpbnB1dE1heDogMSxcbiAgICAgIG91dHB1dE1pbjogMCxcbiAgICAgIG91dHB1dE1heDogMSxcbiAgICB9KTtcblxuICAgIC8vIGJhbmRwYXNzXG4gICAgdGhpcy5ub3JtYWxpemVBY2MgPSBuZXcgbGZvLm9wZXJhdG9yLk11bHRpcGxpZXIoeyBmYWN0b3I6IDEgLyA5LjgxIH0pO1xuICAgIHRoaXMuYmFuZHBhc3MgPSBuZXcgbGZvLm9wZXJhdG9yLkJpcXVhZCh7XG4gICAgICB0eXBlOiAnYmFuZHBhc3MnLFxuICAgICAgcTogMSxcbiAgICAgIGYwOiA1LFxuICAgIH0pO1xuICAgIHRoaXMuYmFuZHBhc3NHYWluID0gbmV3IGxmby5vcGVyYXRvci5NdWx0aXBsaWVyKHsgZmFjdG9yOiAxIH0pO1xuXG4gICAgLy8gb3JpZW50YXRpb24gZmlsdGVyXG4gICAgdGhpcy5vcmllbnRhdGlvbiA9IG5ldyBsZm9Nb3Rpb24ub3BlcmF0b3IuT3JpZW50YXRpb24oKTtcblxuICAgIC8vIG1lcmdlIGFuZCBvdXRwdXRcbiAgICB0aGlzLm1lcmdlciA9IG5ldyBsZm8ub3BlcmF0b3IuTWVyZ2VyKHtcbiAgICAgIGZyYW1lU2l6ZXM6IFsxLCAxLCAzLCAzXSxcbiAgICB9KTtcblxuICAgIHRoaXMuYnJpZGdlID0gbmV3IGxmby5zaW5rLkJyaWRnZSh7XG4gICAgICBwcm9jZXNzRnJhbWU6IHRoaXMuX2VtaXQsXG4gICAgICBmaW5hbGl6ZVN0cmVhbTogdGhpcy5fZW1pdCxcbiAgICB9KTtcblxuICAgIHRoaXMubW90aW9uSW5wdXQuY29ubmVjdCh0aGlzLnNhbXBsZXIpO1xuICAgIC8vIGZvciBpbnRlbnNpdHkgYW5kIGJhbmRwYXNzXG4gICAgdGhpcy5zYW1wbGVyLmNvbm5lY3QodGhpcy5hY2NTZWxlY3QpO1xuICAgIC8vIGludGVuc2l0eSBicmFuY2hcbiAgICB0aGlzLmFjY1NlbGVjdC5jb25uZWN0KHRoaXMuaW50ZW5zaXR5KTtcbiAgICB0aGlzLmludGVuc2l0eS5jb25uZWN0KHRoaXMuaW50ZW5zaXR5Tm9ybVNlbGVjdCk7XG4gICAgdGhpcy5pbnRlbnNpdHlOb3JtU2VsZWN0LmNvbm5lY3QodGhpcy5tZXJnZXIpO1xuICAgIC8vIGJvb3N0IGJyYW5jaFxuICAgIHRoaXMuaW50ZW5zaXR5Tm9ybVNlbGVjdC5jb25uZWN0KHRoaXMuaW50ZW5zaXR5Q2xpcCk7XG4gICAgdGhpcy5pbnRlbnNpdHlDbGlwLmNvbm5lY3QodGhpcy5pbnRlbnNpdHlQb3dlcik7XG4gICAgdGhpcy5pbnRlbnNpdHlQb3dlci5jb25uZWN0KHRoaXMucG93ZXJDbGlwKTtcbiAgICB0aGlzLnBvd2VyQ2xpcC5jb25uZWN0KHRoaXMucG93ZXJTY2FsZSk7XG4gICAgdGhpcy5wb3dlclNjYWxlLmNvbm5lY3QodGhpcy5tZXJnZXIpO1xuICAgIC8vIGJpcXVhZCBicmFuY2hcbiAgICB0aGlzLmFjY1NlbGVjdC5jb25uZWN0KHRoaXMubm9ybWFsaXplQWNjKTtcbiAgICB0aGlzLm5vcm1hbGl6ZUFjYy5jb25uZWN0KHRoaXMuYmFuZHBhc3MpO1xuICAgIHRoaXMuYmFuZHBhc3MuY29ubmVjdCh0aGlzLmJhbmRwYXNzR2Fpbik7XG4gICAgdGhpcy5iYW5kcGFzc0dhaW4uY29ubmVjdCh0aGlzLm1lcmdlcik7XG4gICAgLy8gb3JpZW50YXRpb25cbiAgICB0aGlzLnNhbXBsZXIuY29ubmVjdCh0aGlzLm9yaWVudGF0aW9uKTtcbiAgICB0aGlzLm9yaWVudGF0aW9uLmNvbm5lY3QodGhpcy5tZXJnZXIpO1xuXG4gICAgdGhpcy5tZXJnZXIuY29ubmVjdCh0aGlzLmJyaWRnZSk7XG5cbiAgICB0aGlzLl9saXN0ZW5lcnMgPSBuZXcgU2V0KCk7XG4gIH1cblxuICBpbml0KCkge1xuICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLm1vdGlvbklucHV0LmluaXQoKTtcbiAgICAvLyBwcm9taXNlLnRoZW4oKCkgPT4ge1xuICAgICAgdGhpcy5mcmFtZVJhdGUgPSB0aGlzLm1vdGlvbklucHV0LnN0cmVhbVBhcmFtcy5mcmFtZVJhdGU7XG4gICAgLy8gfSlcbiAgICAvLyAuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyLnN0YWNrKSk7XG5cbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCBsaXN0ZW5pbmcgdG8gdGhlIHNlbnNvcnNcbiAgICovXG4gIHN0YXJ0KCkge1xuICAgIHRoaXMubW90aW9uSW5wdXQuc3RhcnQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wIGxpc3RlbmluZyB0byB0aGUgc2Vuc29yc1xuICAgKi9cbiAgc3RvcCgpIHtcbiAgICB0aGlzLm1vdGlvbklucHV0LnN0b3AoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBsaXN0ZW5lciB0byB0aGUgbW9kdWxlLlxuICAgKlxuICAgKiBAcGFyYW0ge1Byb2Nlc3NlZFNlbnNvcnNMaXN0ZW5lcn0gY2FsbGJhY2sgLSBMaXN0ZW5lciB0byByZWdpc3RlciwgdGhlXG4gICAqICBjYWxsYmFjayBpcyBleGVjdXRlZCB3aXRoIGFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIHByb2Nlc3NlZCBkYXRhIGZyb21cbiAgICogIHRoZSBzZW5zb3JzXG4gICAqL1xuICBhZGRMaXN0ZW5lcihjYWxsYmFjaykge1xuICAgIHRoaXMuX2xpc3RlbmVycy5hZGQoY2FsbGJhY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhIGxpc3RlbmVyIGZyb20gdGhlIG1vZHVsZS5cbiAgICpcbiAgICogQHBhcmFtIHtQcm9jZXNzZWRTZW5zb3JzTGlzdGVuZXJ9IGNhbGxiYWNrIC0gTGlzdGVuZXIgdG8gZGVsZXRlXG4gICAqL1xuICByZW1vdmVMaXN0ZW5lcihjYWxsYmFjaykge1xuICAgIHRoaXMuX2xpc3RlbmVycy5kZWxldGUoY2FsbGJhY2spO1xuICB9XG5cbiAgLyoqIEBwcml2YXRlICovXG4gIF9lbWl0KGZyYW1lKSB7XG4gICAgdGhpcy5fbGlzdGVuZXJzLmZvckVhY2gobGlzdGVuZXIgPT4gbGlzdGVuZXIoZnJhbWUuZGF0YSkpO1xuICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgUHJvY2Vzc2VkU2Vuc29ycztcbiJdfQ==