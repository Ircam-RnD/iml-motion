'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _set=require('babel-runtime/core-js/set');var _set2=_interopRequireDefault(_set);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _client=require('waves-lfo/client');var lfo=_interopRequireWildcard(_client);var _lfoMotion=require('lfo-motion');var lfoMotion=_interopRequireWildcard(_lfoMotion);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
 * High-level abstraction that listen for raw sensors (accelerometers and
 * gyroscopes) and apply a set of preprocessing / filtering on it.
 *
 * The output is composed of 8 values:
 * - IntensityNorm
 * - IntensityNormBoost
 * - BandPass AccX
 * - BandPass AccY
 * - BandPass AccZ
 * - Orientation X (processed from acc and gyro)
 * - Orientation Y (processed from acc and gyro)
 * - Orientation Z (processed from acc and gyro)
 *
 * @example
 * import { ProcessedSensors } from 'iml-motion';
 *
 * const processedSensors = new ProcessedSensors();
 * processedSensors.addListener(data => console.log(data));
 * processedSensors
 *  .init()
 *  .then(() => processedSensors.start());
 */var ProcessedSensors=function(){function ProcessedSensors(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$frameRate=_ref.frameRate,frameRate=_ref$frameRate===undefined?1/0.02:_ref$frameRate;(0,_classCallCheck3.default)(this,ProcessedSensors);this.frameRate=frameRate;this._emit=this._emit.bind(this);// create the lfo graph
this.motionInput=new lfoMotion.source.MotionInput();this.sampler=new lfoMotion.operator.Sampler({frameRate:frameRate});this.accSelect=new lfo.operator.Select({indexes:[0,1,2]});// intensity
this.intensity=new lfoMotion.operator.Intensity({feedback:0.7,gain:0.07});this.intensityNormSelect=new lfo.operator.Select({index:0});// boost
this.intensityClip=new lfo.operator.Clip({min:0,max:1});this.intensityPower=new lfo.operator.Power({exponent:0.25});this.powerClip=new lfo.operator.Clip({min:0.15,max:1});this.powerScale=new lfo.operator.Scale({inputMin:0.15,inputMax:1,outputMin:0,outputMax:1});// bandpass
this.normalizeAcc=new lfo.operator.Multiplier({factor:1/9.81});this.bandpass=new lfo.operator.Biquad({type:'bandpass',q:1,f0:5});this.bandpassGain=new lfo.operator.Multiplier({factor:1});// orientation filter
this.orientation=new lfoMotion.operator.Orientation();// merge and output
this.merger=new lfo.operator.Merger({frameSizes:[1,1,3,3]});this.bridge=new lfo.sink.Bridge({processFrame:this._emit,finalizeStream:this._emit});this.motionInput.connect(this.sampler);// for intensity and bandpass
this.sampler.connect(this.accSelect);// intensity branch
this.accSelect.connect(this.intensity);this.intensity.connect(this.intensityNormSelect);this.intensityNormSelect.connect(this.merger);// boost branch
this.intensityNormSelect.connect(this.intensityClip);this.intensityClip.connect(this.intensityPower);this.intensityPower.connect(this.powerClip);this.powerClip.connect(this.powerScale);this.powerScale.connect(this.merger);// biquad branch
this.accSelect.connect(this.normalizeAcc);this.normalizeAcc.connect(this.bandpass);this.bandpass.connect(this.bandpassGain);this.bandpassGain.connect(this.merger);// orientation
this.sampler.connect(this.orientation);this.orientation.connect(this.merger);this.merger.connect(this.bridge);this._listeners=new _set2.default();}/**
   * Initialize the sensors
   * @return Promise
   */(0,_createClass3.default)(ProcessedSensors,[{key:'init',value:function init(){// do not override frameRate with values from motionInput as
// we resampler overrides the source sampleRate, cf. `constructor`
return this.motionInput.init();}/**
   * Start listening to the sensors
   */},{key:'start',value:function start(){this.motionInput.start();}/**
   * Stop listening to the sensors
   */},{key:'stop',value:function stop(){this.motionInput.stop();}/**
   * Add a listener to the module.
   *
   * @param {ProcessedSensorsListener} callback - Listener to register, the
   *  callback is executed with an array containing the processed data from
   *  the sensors
   */},{key:'addListener',value:function addListener(callback){this._listeners.add(callback);}/**
   * Remove a listener from the module.
   *
   * @param {ProcessedSensorsListener} callback - Listener to delete
   */},{key:'removeListener',value:function removeListener(callback){this._listeners.delete(callback);}/** @private */},{key:'_emit',value:function _emit(frame){this._listeners.forEach(function(listener){return listener(frame.data);});}}]);return ProcessedSensors;}();exports.default=ProcessedSensors;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImxmbyIsImxmb01vdGlvbiIsIlByb2Nlc3NlZFNlbnNvcnMiLCJmcmFtZVJhdGUiLCJfZW1pdCIsImJpbmQiLCJtb3Rpb25JbnB1dCIsInNvdXJjZSIsIk1vdGlvbklucHV0Iiwic2FtcGxlciIsIm9wZXJhdG9yIiwiU2FtcGxlciIsImFjY1NlbGVjdCIsIlNlbGVjdCIsImluZGV4ZXMiLCJpbnRlbnNpdHkiLCJJbnRlbnNpdHkiLCJmZWVkYmFjayIsImdhaW4iLCJpbnRlbnNpdHlOb3JtU2VsZWN0IiwiaW5kZXgiLCJpbnRlbnNpdHlDbGlwIiwiQ2xpcCIsIm1pbiIsIm1heCIsImludGVuc2l0eVBvd2VyIiwiUG93ZXIiLCJleHBvbmVudCIsInBvd2VyQ2xpcCIsInBvd2VyU2NhbGUiLCJTY2FsZSIsImlucHV0TWluIiwiaW5wdXRNYXgiLCJvdXRwdXRNaW4iLCJvdXRwdXRNYXgiLCJub3JtYWxpemVBY2MiLCJNdWx0aXBsaWVyIiwiZmFjdG9yIiwiYmFuZHBhc3MiLCJCaXF1YWQiLCJ0eXBlIiwicSIsImYwIiwiYmFuZHBhc3NHYWluIiwib3JpZW50YXRpb24iLCJPcmllbnRhdGlvbiIsIm1lcmdlciIsIk1lcmdlciIsImZyYW1lU2l6ZXMiLCJicmlkZ2UiLCJzaW5rIiwiQnJpZGdlIiwicHJvY2Vzc0ZyYW1lIiwiZmluYWxpemVTdHJlYW0iLCJjb25uZWN0IiwiX2xpc3RlbmVycyIsImluaXQiLCJzdGFydCIsInN0b3AiLCJjYWxsYmFjayIsImFkZCIsImRlbGV0ZSIsImZyYW1lIiwiZm9yRWFjaCIsImxpc3RlbmVyIiwiZGF0YSJdLCJtYXBwaW5ncyI6InFaQUFBLHdDLEdBQVlBLEksa0NBQ1oscUMsR0FBWUMsVSxrV0FFWjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztNQXVCTUMsaUIsWUFDSiwyQkFFUSxvRUFBSixFQUFJLHFCQUROQyxTQUNNLENBRE5BLFNBQ00sNEJBRE0sRUFBSSxJQUNWLG9FQUNOLEtBQUtBLFNB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LFFBQXBCLEVBQ0QsQ0FFRDs7OzsyREFLZUEsUSxDQUFVLENBQ3ZCLEtBQUtKLFVBQUwsQ0FBZ0JNLE1BQWhCLENBQXVCRixRQUF2QixFQUNELENBRUQsZSxvQ0FDTUcsSyxDQUFPLENBQ1gsS0FBS1AsVUFBTCxDQUFnQlEsT0FBaEIsQ0FBd0IseUJBQVlDLFVBQVNGLE1BQU1HLElBQWYsQ0FBWixFQUF4QixFQUNELEMsZ0RBSVkvRCxnQiIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGxmbyBmcm9tICd3YXZlcy1sZm8vY2xpZW50JztcbmltcG9ydCAqIGFzIGxmb01vdGlvbiBmcm9tICdsZm8tbW90aW9uJztcblxuLyoqXG4gKiBIaWdoLWxldmVsIGFic3RyYWN0aW9uIHRoYXQgbGlzdGVuIGZvciByYXcgc2Vuc29ycyAoYWNjZWxlcm9tZXRlcnMgYW5kXG4gKiBneXJvc2NvcGVzKSBhbmQgYXBwbHkgYSBzZXQgb2YgcHJlcHJvY2Vzc2luZyAvIGZpbHRlcmluZyBvbiBpdC5cbiAqXG4gKiBUaGUgb3V0cHV0IGlzIGNvbXBvc2VkIG9mIDggdmFsdWVzOlxuICogLSBJbnRlbnNpdHlOb3JtXG4gKiAtIEludGVuc2l0eU5vcm1Cb29zdFxuICogLSBCYW5kUGFzcyBBY2NYXG4gKiAtIEJhbmRQYXNzIEFjY1lcbiAqIC0gQmFuZFBhc3MgQWNjWlxuICogLSBPcmllbnRhdGlvbiBYIChwcm9jZXNzZWQgZnJvbSBhY2MgYW5kIGd5cm8pXG4gKiAtIE9yaWVudGF0aW9uIFkgKHByb2Nlc3NlZCBmcm9tIGFjYyBhbmQgZ3lybylcbiAqIC0gT3JpZW50YXRpb24gWiAocHJvY2Vzc2VkIGZyb20gYWNjIGFuZCBneXJvKVxuICpcbiAqIEBleGFtcGxlXG4gKiBpbXBvcnQgeyBQcm9jZXNzZWRTZW5zb3JzIH0gZnJvbSAnaW1sLW1vdGlvbic7XG4gKlxuICogY29uc3QgcHJvY2Vzc2VkU2Vuc29ycyA9IG5ldyBQcm9jZXNzZWRTZW5zb3JzKCk7XG4gKiBwcm9jZXNzZWRTZW5zb3JzLmFkZExpc3RlbmVyKGRhdGEgPT4gY29uc29sZS5sb2coZGF0YSkpO1xuICogcHJvY2Vzc2VkU2Vuc29yc1xuICogIC5pbml0KClcbiAqICAudGhlbigoKSA9PiBwcm9jZXNzZWRTZW5zb3JzLnN0YXJ0KCkpO1xuICovXG5jbGFzcyBQcm9jZXNzZWRTZW5zb3JzIHtcbiAgY29uc3RydWN0b3Ioe1xuICAgIGZyYW1lUmF0ZSA9IDEgLyAwLjAyLFxuICB9ID0ge30pIHtcbiAgICB0aGlzLmZyYW1lUmF0ZSA9IGZyYW1lUmF0ZTtcblxuICAgIHRoaXMuX2VtaXQgPSB0aGlzLl9lbWl0LmJpbmQodGhpcyk7XG5cbiAgICAvLyBjcmVhdGUgdGhlIGxmbyBncmFwaFxuICAgIHRoaXMubW90aW9uSW5wdXQgPSBuZXcgbGZvTW90aW9uLnNvdXJjZS5Nb3Rpb25JbnB1dCgpO1xuXG4gICAgdGhpcy5zYW1wbGVyID0gbmV3IGxmb01vdGlvbi5vcGVyYXRvci5TYW1wbGVyKHtcbiAgICAgIGZyYW1lUmF0ZTogZnJhbWVSYXRlLFxuICAgIH0pO1xuXG4gICAgdGhpcy5hY2NTZWxlY3QgPSBuZXcgbGZvLm9wZXJhdG9yLlNlbGVjdCh7IGluZGV4ZXM6IFswLCAxLCAyXSB9KTtcblxuICAgIC8vIGludGVuc2l0eVxuICAgIHRoaXMuaW50ZW5zaXR5ID0gbmV3IGxmb01vdGlvbi5vcGVyYXRvci5JbnRlbnNpdHkoe1xuICAgICAgZmVlZGJhY2s6IDAuNyxcbiAgICAgIGdhaW46IDAuMDcsXG4gICAgfSk7XG5cbiAgICB0aGlzLmludGVuc2l0eU5vcm1TZWxlY3QgPSBuZXcgbGZvLm9wZXJhdG9yLlNlbGVjdCh7IGluZGV4OiAwIH0pO1xuXG4gICAgLy8gYm9vc3RcbiAgICB0aGlzLmludGVuc2l0eUNsaXAgPSBuZXcgbGZvLm9wZXJhdG9yLkNsaXAoeyBtaW46IDAsIG1heDogMSB9KTtcbiAgICB0aGlzLmludGVuc2l0eVBvd2VyID0gbmV3IGxmby5vcGVyYXRvci5Qb3dlcih7IGV4cG9uZW50OiAwLjI1IH0pO1xuICAgIHRoaXMucG93ZXJDbGlwID0gbmV3IGxmby5vcGVyYXRvci5DbGlwKHsgbWluOiAwLjE1LCBtYXg6IDEgfSk7XG4gICAgdGhpcy5wb3dlclNjYWxlID0gbmV3IGxmby5vcGVyYXRvci5TY2FsZSh7XG4gICAgICBpbnB1dE1pbjogMC4xNSxcbiAgICAgIGlucHV0TWF4OiAxLFxuICAgICAgb3V0cHV0TWluOiAwLFxuICAgICAgb3V0cHV0TWF4OiAxLFxuICAgIH0pO1xuXG4gICAgLy8gYmFuZHBhc3NcbiAgICB0aGlzLm5vcm1hbGl6ZUFjYyA9IG5ldyBsZm8ub3BlcmF0b3IuTXVsdGlwbGllcih7IGZhY3RvcjogMSAvIDkuODEgfSk7XG4gICAgdGhpcy5iYW5kcGFzcyA9IG5ldyBsZm8ub3BlcmF0b3IuQmlxdWFkKHtcbiAgICAgIHR5cGU6ICdiYW5kcGFzcycsXG4gICAgICBxOiAxLFxuICAgICAgZjA6IDUsXG4gICAgfSk7XG4gICAgdGhpcy5iYW5kcGFzc0dhaW4gPSBuZXcgbGZvLm9wZXJhdG9yLk11bHRpcGxpZXIoeyBmYWN0b3I6IDEgfSk7XG5cbiAgICAvLyBvcmllbnRhdGlvbiBmaWx0ZXJcbiAgICB0aGlzLm9yaWVudGF0aW9uID0gbmV3IGxmb01vdGlvbi5vcGVyYXRvci5PcmllbnRhdGlvbigpO1xuXG4gICAgLy8gbWVyZ2UgYW5kIG91dHB1dFxuICAgIHRoaXMubWVyZ2VyID0gbmV3IGxmby5vcGVyYXRvci5NZXJnZXIoe1xuICAgICAgZnJhbWVTaXplczogWzEsIDEsIDMsIDNdLFxuICAgIH0pO1xuXG4gICAgdGhpcy5icmlkZ2UgPSBuZXcgbGZvLnNpbmsuQnJpZGdlKHtcbiAgICAgIHByb2Nlc3NGcmFtZTogdGhpcy5fZW1pdCxcbiAgICAgIGZpbmFsaXplU3RyZWFtOiB0aGlzLl9lbWl0LFxuICAgIH0pO1xuXG4gICAgdGhpcy5tb3Rpb25JbnB1dC5jb25uZWN0KHRoaXMuc2FtcGxlcik7XG4gICAgLy8gZm9yIGludGVuc2l0eSBhbmQgYmFuZHBhc3NcbiAgICB0aGlzLnNhbXBsZXIuY29ubmVjdCh0aGlzLmFjY1NlbGVjdCk7XG4gICAgLy8gaW50ZW5zaXR5IGJyYW5jaFxuICAgIHRoaXMuYWNjU2VsZWN0LmNvbm5lY3QodGhpcy5pbnRlbnNpdHkpO1xuICAgIHRoaXMuaW50ZW5zaXR5LmNvbm5lY3QodGhpcy5pbnRlbnNpdHlOb3JtU2VsZWN0KTtcbiAgICB0aGlzLmludGVuc2l0eU5vcm1TZWxlY3QuY29ubmVjdCh0aGlzLm1lcmdlcik7XG4gICAgLy8gYm9vc3QgYnJhbmNoXG4gICAgdGhpcy5pbnRlbnNpdHlOb3JtU2VsZWN0LmNvbm5lY3QodGhpcy5pbnRlbnNpdHlDbGlwKTtcbiAgICB0aGlzLmludGVuc2l0eUNsaXAuY29ubmVjdCh0aGlzLmludGVuc2l0eVBvd2VyKTtcbiAgICB0aGlzLmludGVuc2l0eVBvd2VyLmNvbm5lY3QodGhpcy5wb3dlckNsaXApO1xuICAgIHRoaXMucG93ZXJDbGlwLmNvbm5lY3QodGhpcy5wb3dlclNjYWxlKTtcbiAgICB0aGlzLnBvd2VyU2NhbGUuY29ubmVjdCh0aGlzLm1lcmdlcik7XG4gICAgLy8gYmlxdWFkIGJyYW5jaFxuICAgIHRoaXMuYWNjU2VsZWN0LmNvbm5lY3QodGhpcy5ub3JtYWxpemVBY2MpO1xuICAgIHRoaXMubm9ybWFsaXplQWNjLmNvbm5lY3QodGhpcy5iYW5kcGFzcyk7XG4gICAgdGhpcy5iYW5kcGFzcy5jb25uZWN0KHRoaXMuYmFuZHBhc3NHYWluKTtcbiAgICB0aGlzLmJhbmRwYXNzR2Fpbi5jb25uZWN0KHRoaXMubWVyZ2VyKTtcbiAgICAvLyBvcmllbnRhdGlvblxuICAgIHRoaXMuc2FtcGxlci5jb25uZWN0KHRoaXMub3JpZW50YXRpb24pO1xuICAgIHRoaXMub3JpZW50YXRpb24uY29ubmVjdCh0aGlzLm1lcmdlcik7XG5cbiAgICB0aGlzLm1lcmdlci5jb25uZWN0KHRoaXMuYnJpZGdlKTtcblxuICAgIHRoaXMuX2xpc3RlbmVycyA9IG5ldyBTZXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSBzZW5zb3JzXG4gICAqIEByZXR1cm4gUHJvbWlzZVxuICAgKi9cbiAgaW5pdCgpIHtcbiAgICAvLyBkbyBub3Qgb3ZlcnJpZGUgZnJhbWVSYXRlIHdpdGggdmFsdWVzIGZyb20gbW90aW9uSW5wdXQgYXNcbiAgICAvLyB3ZSByZXNhbXBsZXIgb3ZlcnJpZGVzIHRoZSBzb3VyY2Ugc2FtcGxlUmF0ZSwgY2YuIGBjb25zdHJ1Y3RvcmBcbiAgICByZXR1cm4gdGhpcy5tb3Rpb25JbnB1dC5pbml0KCk7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgbGlzdGVuaW5nIHRvIHRoZSBzZW5zb3JzXG4gICAqL1xuICBzdGFydCgpIHtcbiAgICB0aGlzLm1vdGlvbklucHV0LnN0YXJ0KCk7XG4gIH1cblxuICAvKipcbiAgICogU3RvcCBsaXN0ZW5pbmcgdG8gdGhlIHNlbnNvcnNcbiAgICovXG4gIHN0b3AoKSB7XG4gICAgdGhpcy5tb3Rpb25JbnB1dC5zdG9wKCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgbGlzdGVuZXIgdG8gdGhlIG1vZHVsZS5cbiAgICpcbiAgICogQHBhcmFtIHtQcm9jZXNzZWRTZW5zb3JzTGlzdGVuZXJ9IGNhbGxiYWNrIC0gTGlzdGVuZXIgdG8gcmVnaXN0ZXIsIHRoZVxuICAgKiAgY2FsbGJhY2sgaXMgZXhlY3V0ZWQgd2l0aCBhbiBhcnJheSBjb250YWluaW5nIHRoZSBwcm9jZXNzZWQgZGF0YSBmcm9tXG4gICAqICB0aGUgc2Vuc29yc1xuICAgKi9cbiAgYWRkTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB0aGlzLl9saXN0ZW5lcnMuYWRkKGNhbGxiYWNrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYSBsaXN0ZW5lciBmcm9tIHRoZSBtb2R1bGUuXG4gICAqXG4gICAqIEBwYXJhbSB7UHJvY2Vzc2VkU2Vuc29yc0xpc3RlbmVyfSBjYWxsYmFjayAtIExpc3RlbmVyIHRvIGRlbGV0ZVxuICAgKi9cbiAgcmVtb3ZlTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB0aGlzLl9saXN0ZW5lcnMuZGVsZXRlKGNhbGxiYWNrKTtcbiAgfVxuXG4gIC8qKiBAcHJpdmF0ZSAqL1xuICBfZW1pdChmcmFtZSkge1xuICAgIHRoaXMuX2xpc3RlbmVycy5mb3JFYWNoKGxpc3RlbmVyID0+IGxpc3RlbmVyKGZyYW1lLmRhdGEpKTtcbiAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IFByb2Nlc3NlZFNlbnNvcnM7XG4iXX0=